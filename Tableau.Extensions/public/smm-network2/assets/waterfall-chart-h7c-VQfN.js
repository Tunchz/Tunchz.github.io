import{i as Q,T as U,u as W,k as Z,o as _}from"./_plugin-vue2_normalizer-xzsEtbse.js";import{c as tt,a as B}from"./main-CVmQxpd7.js";import{b as et,c as at}from"./axis-hLREC-WR.js";import{f as H}from"./defaultLocale-B8TAAL35.js";import{b as rt}from"./band-BVtZk_0J.js";import{l as lt}from"./linear-LTQgAPe2.js";import{m as R}from"./max-DBeXZoyG.js";import{m as ot}from"./min-D1slsF82.js";import{s as st}from"./selectAll-Cx8JdGyI.js";import"./index-BvYcEE5T.js";import"./range-OtVwhkKS.js";function bt(d,o,l,i){let n=new Map,c=o[0],u=o[1];Q()&&d.reverse();let h=i.extraSettings[0]?i.extraSettings[0]==="1":1,s=i.extraSettings[1]?i.extraSettings[1]==="1":1,M=i.extraSettings[2]||"all",A=d[0][c].formattedValue,C=A;for(let e=0;e<d.length;e++){let a=d[e];if(h&&A===a[c].formattedValue)if(n.has(a[c].formattedValue)){let b=n.get(a[c].formattedValue);b.value=b.value+a[l].value,b.difference=b.value}else n.set(a[c].formattedValue,{hidden:!1,id:a[c].formattedValue,name:a[c].formattedValue,difference:a[l].value,value:a[l].value,xAxis:a[u].value,xAxisDimension:i.dimensions[1],category:a[c].formattedValue,catDimension:i.dimensions[0],firstCategory:!0});e>1&&d[e-1][c].formattedValue!==a[c].formattedValue&&(C=d[e-1][c].formattedValue);let m=n.get(a[u].formattedValue+"|||"+C),y=!!(h&&A===a[c].formattedValue);n.set(a[u].formattedValue+"|||"+a[c].formattedValue,{hidden:y,id:a[u].formattedValue+"|||"+a[c].formattedValue,name:a[u].formattedValue,difference:m?a[l].value-m.value:a[l].value,value:a[l].value,xAxis:a[u].formattedValue,xAxisDimension:i.dimensions[1],category:a[c].formattedValue,catDimension:i.dimensions[0]})}let D=0;n=Array.from(n.values()),n=n.filter(function(e){return!e.hidden}),n.map((e,a)=>{if(e.hidden)return;let m=s?e.value:e.difference;if(e.start=D,e.class=m>=0?"positive":"negative",M==="contains")if(a>1&&e.name.includes("total")){e.end=0,e.class="total";return}else e.name.includes("total")&&(e.class="total",e.start=0);D+=m,e.end=D});let g=[...n];for(let e=1;e<g.length;e++){let a=g[e],m=g[e-1],y=n.findIndex(b=>a.id===b.id);M==="all"&&(a.category!==m.category&&e>1&&k(m.category,y-1,1),e===g.length-1&&k(a.category,y,1))}function k(e,a,m=0){let y=n[a].end;n.splice(a+m,0,{id:e,name:e,category:e,catDimension:i.dimensions[0],start:y,end:0,class:"total"})}return n}let N=null;function Vt(d,o,l){let{measureFormat:i,measureStyle:n,color:c,width:u,height:h,extraSettings:s,isDarkTheme:M,fontSize:A,fontSizeLabels:C,dimensionColors:D,memberColors:g,useNewColorFormat:k}=l;const e=new U("#tooltip",u,h);let a=s[0]?s[0]==="1":1,m=l.extraSettings[2]||"all",y=s[3]?s[3]==="1":1,b=s[4]?s[4]==="1":1,G=s[5]?s[5]==="1":1,P=s[6]?s[6]==="1":1,O=s[7]||15,Y=parseInt(s[8])||40,j=s[9]||80,S=s[10]===0?0:s[10]/100||0,z=s[11]||(l!=null&&l.textColorAxis?l.textColorAxis:"#666666"),L=s[12]||(l!=null&&l.textColorAxis?l.textColorAxis:"#666666"),q=s[13]||"#55aa00",J=s[14]||"#e12424",$=s[15]||"#00557f";i||(i=",.0f");let v=H(i);n&&(v=_(n));let p={top:P?50:y?30:10,right:10,bottom:Y,left:j};u=u-p.left-p.right,h=h-p.top-p.bottom;let E=.3,V=rt().rangeRound([0,u]).padding(E);const f=lt().range([h,0]),I=et(V),K=at(f).tickFormat(t=>v(t));let T=d.attr("width",u+p.left+p.right).attr("height",h+p.top+p.bottom).append("g").attr("transform",`translate(${p.left},${p.top})`);d.on("click",X),V.domain(o.map(t=>t.id)),I.tickFormat(t=>m==="contains"?t.split("|||")[0].replace("total","").trim():t.split("|||")[0]),R(o,t=>t);const w=()=>{let t="";if(m!=="all")o.forEach(r=>{(r.class==="total"||r.class==="positive"&&r.end===0||r.class==="positive"&&r.start===0)&&(r.class==="positive"&&r.start===0?t=r.end*S:t=r.start*S)});else{let r=o[0].end;for(let x=0;x<o.length;x++)o[x].end===0&&o[x].start===0?r=0:o[x].end<r&&o[x].class!=="total"&&(r=o[x].end);t=r*S}return t};f.domain([ot(o,t=>S!==void 0?w():t.start),R(o,t=>t.end)]),b&&T.append("g").attr("class","x axis").style("color",L).style("font-size",A+"rem").attr("transform",`translate(0,${h})`).call(I).selectAll("text").style("color",z).style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",`rotate(-${O})`),G&&T.append("g").attr("class","y axis").style("color",L).style("font-size",A+"rem").call(K).selectAll("text").style("color",z);const F=T.selectAll(".bar").data(o).enter().append("g").attr("fill",(t,r)=>{if(r===0&&a)return $||"#FF8900";switch(t.class){case"positive":return q||"#417AAB";case"negative":return J||"#95CCEB";default:return $||"#FF8900"}}).attr("transform",t=>`translate(${V(t.id)},0)`);F.append("rect").attr("y",t=>f(Math.max(t.start,t.end))).attr("height",t=>t.start<w()?Math.abs(f(w())-f(t.end)):t.end<w()?Math.abs(f(t.start)-f(w())):Math.abs(f(t.start)-f(t.end))).attr("width",V.bandwidth()).on("click",nt).classed("focus",t=>t.xAxisDimension===N).on("mouseover",(t,r)=>{var x;t.class==="total"&&l.tooltips.total?e.show(((x=l.tooltips.total)==null?void 0:x.content)||l.tooltips.total,{DimensionName:t.name,MeasureValue:v(t.class==="total"?t.start===0?t.value:t.start:t.value).bold()}):e.show(l.tooltips.node.content||l.tooltips.node,{DimensionName:t.name,MeasureValue:v(t.class==="total"?t.start===0?t.value:t.start:t.value).bold(),Start:v(t.start).bold(),End:v(t.value).bold()})}).on("mousemove",()=>{e.updatePosition()}).on("mouseout",()=>{e.hide()}),y&&F.append("text").attr("x",V.bandwidth()/2).attr("y",(t,r)=>t.class==="total"&&t.start<=0||t.class==="positive"?f(t.end):f(t.start)).style("text-anchor","middle").style("font-size",C+"rem"||"1rem").attr("dy","-.5em").text((t,r)=>W(l.labels.node.content,{DimensionValue:t.name,MeasureValue:r===0?v(t.end-t.start):t.class==="total"?v(t.start-t.end):v(t.end-t.start)})),P&&F.filter((t,r)=>t.class!=="total"&&r!==0).append("text").style("text-anchor","middle").style("font-weight","bold").attr("x",V.bandwidth()/2).attr("y",-40).attr("dy",".3em").text(t=>`${H(".1f")(100*(t.end-t.start)/t.start)}%`),F.filter((t,r)=>r!==o.length-1).append("line").attr("class","connector").style("stroke","#999").style("stroke-dasharray",3).attr("x1",V.bandwidth()).attr("y1",(t,r)=>t.class==="total"&&r>0?f(t.start):f(t.end)).attr("x2",V.bandwidth()/(1-E)).attr("y2",(t,r)=>t.class==="total"&&r>0?f(t.start):f(t.end))}function X(){return N=null,st("rect").classed("focus",!1),tt()}const nt=async function(o){event.stopPropagation();let l=Z(this),i=l.classed("focus");await X(),!i&&(N=o.xAxisDimension,l.classed("focus",!0),o.class==="total"||o.firstCategory?B(o.catDimension,o.category):B(o.xAxisDimension,o.xAxis))};export{Vt as draw,bt as parse};
//# sourceMappingURL=waterfall-chart-h7c-VQfN.js.map
