import"./index-BNR9-8HJ.js";import{q as ae,l as ne,T as re,L as Y,k as oe,o as le}from"./_plugin-vue2_normalizer-xzsEtbse.js";import{i as ie,j as se,g as ue}from"./main-CVmQxpd7.js";import{f as fe}from"./defaultLocale-B8TAAL35.js";import{h as de,a as ce,i as R,e as me,l as pe}from"./linear-LTQgAPe2.js";import{a as he}from"./arc-C_gK823d.js";import{s as S}from"./selectAll-Cx8JdGyI.js";import{p as ge}from"./partition-CeLLDKlx.js";import{h as ye}from"./index-DmxxRM1L.js";import"./index-BvYcEE5T.js";import"./constant-I5scnKCP.js";import"./math-CBKwitpL.js";function j(t){return function(r){return r<0?-Math.pow(-r,t):Math.pow(r,t)}}function Ne(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function we(t){return t<0?-t*t:t*t}function Me(t){var r=t(R,R),n=1;function N(){return n===1?t(R,R):n===.5?t(Ne,we):t(j(n),j(1/n))}return r.exponent=function(c){return arguments.length?(n=+c,N()):n},me(r)}function X(){var t=Me(de());return t.copy=function(){return ce(t,X()).exponent(t.exponent())},ie.apply(t,arguments),t}function xe(){return X.apply(null,arguments).exponent(.5)}function Ae(t,r,n,N){let c={isMainNode:!0,name:"",children:[]};for(let g of t){let m=c.children;for(let u=0;u<r.length;u++){let p=N.dimensions[u],w=r[u],f=g[w].formattedValue,x=ae(g,n),o=ne(g[w]),l=m.find(d=>d.name===f);l||(u===r.length-1?l={name:f,dimension:p,size:x,isNull:o}:l={name:f,dimension:p,isNull:o,children:[]},m.push(l)),m=l.children}}return c}let I=null;function Ve(t,r,n){let{measureName:N,measureFormat:c,measureStyle:g,color:m,width:u,fontSize:p,isDarkTheme:w,height:f,backgroundColor:x,extraSettings:o,memberColors:l,memberColorsSunburst:d,useNewColorFormat:v,enableLegend:b,legendPosition:h,legendRows:y,legendColumns:M,legendPaddingX:E,legendPaddingY:G}=n,C=o[0]||"values",H=o[1]===void 0?1:o[1]==="0"?0:1,J=o[2]===void 0?1:o[2]==="0"?0:1,q=o[3]===void 0?1:o[3]==="0"?0:1,z=parseInt(o[4])||-20,K=(parseFloat(o[5])||100)/100,Q=o[6]||(n!=null&&n.textColor?n.textColor:"#ffffff"),U=o[7]||"#000000";const F=new re("#tooltip",u,f);var T=0,k=1;let A=5,V=u-A,L=f-A;b&&(k=1-.06*y,h==="top"?T=y*18+10:h==="bottom"?(T=-(y*8+15),L-=(y-1)*18+33):(k=.9,h.includes("right")&&(V-=M*100+25),h.includes("bottom")&&(C==="values"?L-=Math.ceil(l.length/M)*18+20:L-=Math.ceil(r.children.length/M)*18+20)));let B=(Math.min(u,f)/2-10)*k;const D=(e=>ge().size([2*Math.PI,B])(ye(e).sum(a=>a.size).each(a=>a.current=a)))(r);c||(c=",.0f");let $=fe(c);g&&($=le(g)),pe().range([0,2*Math.PI]),xe().range([0,B]);var W=he().startAngle(e=>e.x0).endAngle(e=>e.x1).innerRadius(e=>e.y0).outerRadius(e=>e.y1-1);if(b){let e=b&&h.includes("right")?V:10,a=b&&h.includes("bottom")?L:20;e+=parseInt(E),a+=parseInt(G),C==="values"?new Y(t,l,w).title(n.legendTitle?n.legendTitle:"Color Legend").text(i=>i.fieldName).offset(e,a).positioning(h).nrRows(y).nrColumns(M).color(i=>{if(v){for(var s=0;s<l.length;s++)if(l[s].fieldName===i)return l[s].color}else return m(i)}).draw():C==="level"&&new Y(t,r.children,w).title(n.legendTitle?n.legendTitle:"Legend").text(i=>i.name).offset(e,a).positioning(h).nrRows(y).nrColumns(M).color(i=>{if(v){for(var s=0;s<d.length;s++)if(d[s].fieldName===i)return d[s].color}else return m(i)}).draw()}t.append("g").attr("transform",`translate(${u/2},${f/2+T})`).selectAll("path").data(D.descendants().filter(e=>!e.data.isMainNode)).enter().filter(e=>!e.data.isNull).append("path").attr("stroke",x).attr("fill-opacity",K).attr("class","path").classed("focus",e=>e.data.name===I).attr("d",W).attr("fill",e=>{if(e.data.isMainNode)return x;if(C==="level"){for(;e.depth>1;)e=e.parent;if(v){for(var a=0;a<d.length;a++)if(d[a].fieldName===e.data.name)return d[a].color}return m(e.data.name)}else{if(v){for(var a=0;a<l.length;a++)if(l[a].fieldName===e.data.name)return l[a].color}return m(e.data.name)}}).on("click",Z).on("mouseover",e=>{F.show(n.tooltips.node.content||n.tooltips.node,{DimensionName:e.data.dimension,DimensionValue:e.data.name.bold(),MeasureName:N,MeasureValue:$(e.value).bold()})}).on("mousemove",()=>{F.updatePosition()}).on("mouseout",()=>{F.hide()}),t.append("g").attr("transform",`translate(${u/2},${f/2+T})`).attr("pointer-events","none").attr("text-anchor","middle").attr("font-family","arial").attr("fill-opacity",.8).selectAll("text").data(D.descendants().filter(e=>(e.y0+e.y1)/2*(e.x1-e.x0)>25*p&&!e.data.isNull)).join("text").attr("text-anchor","middle").attr("dominant-baseline","middle").attr("transform",function(e){const a=(e.x0+e.x1)/2*180/Math.PI,i=(e.y0+e.y1)/2;return e.data.isMainNode?`translate(${i},0) `:`rotate(${a-90}) translate(${i},0) rotate(${a<180?0:180})`}).attr("fill",function(e){return e.data.isMainNode?U:Q}).append("tspan").attr("font-size",function(e){return e.data.isMainNode?p*2+"rem":p+"rem"}).attr("x",function(e){return e.data.isMainNode?(t.node().getBoundingClientRect().width/2,z):0}).attr("y",0).attr("dy","0em").text(e=>e.data.isMainNode&&q?`${$(e.value)}`:H&&!e.data.isMainNode?`${$(e.value)}`:"").append("tspan").attr("font-size",function(e){return e.data.isMainNode?p*1.2+"rem":p*.7+"rem"}).attr("x",function(e){return e.data.isMainNode?(t.node().getBoundingClientRect().width/2,z):0}).attr("y",0).attr("dy","1.2em").attr("fill-opacity",.6).text(function(e){return e.data.isMainNode&&q?"Total":J?e.data.name:""});function Z(e){event.stopPropagation();let a=oe(this),i=a.classed("focus");if(_(),i)return;I=e.data.name,a.classed("focus",!0);let s=[];function O(ee,P){if(s.push({fieldName:ee,value:[P.data.name]}),P.parent.depth>0){let te=P.parent.data.dimension||null;O(te,P.parent)}}O(e.data.dimension,e),se(s),S(".path").style("opacity",.4),S(".focus").style("opacity",1)}function _(){I=null,S(".path").style("opacity",1),S(".focus").classed("focus",!1),ue()}}export{Ve as draw,Ae as parse};
//# sourceMappingURL=sunburst-new-BxIY2v78.js.map
