import{a as X,b as te}from"./index-BNR9-8HJ.js";import{M as ne,N as q,a as E,q as re,T as ae,L as oe,k as ie,o as le}from"./_plugin-vue2_normalizer-xzsEtbse.js";import{b as se,c as ce}from"./main-CVmQxpd7.js";import{f as ue}from"./defaultLocale-B8TAAL35.js";import{a as fe}from"./arc-C_gK823d.js";import{s as me}from"./selectAll-Cx8JdGyI.js";import{h as de}from"./index-DmxxRM1L.js";import{p as pe}from"./partition-CeLLDKlx.js";import"./index-BvYcEE5T.js";import"./constant-I5scnKCP.js";import"./math-CBKwitpL.js";function he(a,t){t||(t=[]);var r=a?Math.min(t.length,a.length):0,l=t.slice(),o;return function(c){for(o=0;o<r;++o)l[o]=a[o]*(1-c)+t[o]*c;return l}}function ye(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)}function ge(a,t){var r=t?t.length:0,l=a?Math.min(r,a.length):0,o=new Array(l),c=new Array(r),i;for(i=0;i<l;++i)o[i]=I(a[i],t[i]);for(;i<r;++i)c[i]=t[i];return function(f){for(i=0;i<l;++i)c[i]=o[i](f);return c}}function xe(a,t){var r=new Date;return a=+a,t=+t,function(l){return r.setTime(a*(1-l)+t*l),r}}function ve(a,t){var r={},l={},o;(a===null||typeof a!="object")&&(a={}),(t===null||typeof t!="object")&&(t={});for(o in t)o in a?r[o]=I(a[o],t[o]):l[o]=t[o];return function(c){for(o in r)l[o]=r[o](c);return l}}function I(a,t){var r=typeof t,l;return t==null||r==="boolean"?ne(t):(r==="number"?X:r==="string"?(l=q(t))?(t=l,E):te:t instanceof q?E:t instanceof Date?xe:ye(t)?he:Array.isArray(t)?ge:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?ve:X)(a,t)}function Se(a,t,r,l){let o={name:"",children:[]};for(let c of a){let i=o.children;for(let f=0;f<t.length;f++){let M=l.dimensions[f],g=t[f],m=c[g].formattedValue,d=re(c,r),p=i.find(h=>h.name===m);p||(f===t.length-1?p={name:m,dimension:M,size:d}:p={name:m,dimension:M,children:[]},i.push(p)),i=p.children}}return o}let C=null;function Ce(a,t,r){let{measureName:l,measureFormat:o,measureStyle:c,color:i,isDarkTheme:f,extraSettings:M,width:g,height:m,memberColorsSunburst:d,useNewColorFormat:p,enableLegend:h,legendPosition:y,legendRows:N,legendColumns:b,legendPaddingX:G,legendPaddingY:H}=r;const x=new ae("#tooltip",g,m);let J=M[0]||(r!=null&&r.textColor?r.textColor:"#666666"),R=(parseFloat(M[1])||100)/100;const K=e=>{const s=de(e).sum(n=>n.size).sort((n,u)=>u.value-n.value);return pe().size([2*Math.PI,s.height+1])(s)};o||(o=",.0f");let P=ue(o);c&&(P=le(c));var T=0,V=1;let L=5,j=g-L,k=m-L;h&&(V=.95-.06*N,y==="top"?T=N*8+15:y==="bottom"?(T=-(N*18+15),k-=(N-1)*18+33):(V=.9,y.includes("right")&&(j-=b*100+25),y.includes("bottom")&&(k-=Math.ceil(t.children.length/b)*18+20)));const v=K(t),w=Math.min(g,m)/6*V,z=fe().startAngle(e=>e.x0).endAngle(e=>e.x1).padAngle(e=>Math.min((e.x1-e.x0)/2,.005)).padRadius(w*1.5).innerRadius(e=>e.y0*w).outerRadius(e=>Math.max(e.y0*w,e.y1*w-1));if(v.each(e=>e.current=e),h){let e=h&&y.includes("right")?j:10,s=h&&y.includes("bottom")?k:20;e+=parseInt(G),s+=parseInt(H),new oe(a,t.children,f).title(r.legendTitle?r.legendTitle:"Legend").text(n=>n.name).offset(e,s).positioning(y).nrRows(N).nrColumns(b).color(n=>{if(p){for(var u=0;u<d.length;u++)if(d[u].fieldName===n)return d[u].color}else return i(n)}).draw()}const F=a.append("g").attr("transform",`translate(${g/2},${m/2+T})`),O=F.append("g").selectAll("path").data(v.descendants().slice(1)).enter().append("path").attr("fill",e=>{for(;e.depth>1;)e=e.parent;if(p){for(var s=0;s<d.length;s++)if(d[s].fieldName===e.data.name)return d[s].color}return i(e.data.name)}).attr("fill-opacity",e=>D(e.current)?e.children?1*R:.8*R:0).attr("d",e=>z(e.current)).on("mouseover",e=>{x.show(r.tooltips.node.content||r.tooltips.node,{DimensionName:e.data.dimension,DimensionValue:e.data.name.bold(),MeasureName:l,MeasureValue:P(e.value).bold()})}).on("mousemove",()=>{x.updatePosition()}).on("mouseout",()=>{x.hide()});O.filter(e=>e.children).style("cursor","pointer").classed("focus",e=>e.data.dimension===C).on("click",$).on("mouseover",e=>{x.show(r.tooltips.node.content||r.tooltips.node,{DimensionName:e.data.dimension,DimensionValue:e.data.name.bold(),MeasureName:l,MeasureValue:P(e.value).bold()})}).on("mousemove",()=>{x.updatePosition()}).on("mouseout",()=>{x.hide()});const Q=F.append("g").attr("pointer-events","none").attr("text-anchor","middle").style("user-select","none").selectAll("text").data(v.descendants().slice(1)).enter().append("text").style("fill",J).attr("dy","0.35em").attr("fill-opacity",e=>+S(e.current)).attr("transform",e=>Y(e.current)).text(e=>e.data.name).style("font-size",r.fontSize+"rem"),U=F.append("circle").datum(v).attr("r",w).attr("fill","none").attr("stroke",0).attr("pointer-events","all").on("click",$);function $(e){U.datum(e.parent||v),v.each(n=>{n.target={x0:Math.max(0,Math.min(1,(n.x0-e.x0)/(e.x1-e.x0)))*2*Math.PI,x1:Math.max(0,Math.min(1,(n.x1-e.x0)/(e.x1-e.x0)))*2*Math.PI,y0:Math.max(0,n.y0-e.depth),y1:Math.max(0,n.y1-e.depth)}});const s=F.transition().duration(450);O.transition(s).tween("data",n=>{const u=I(n.current,n.target);return B=>n.current=u(B)}).filter(function(n){return+this.getAttribute("fill-opacity")||D(n.target)}).attr("fill-opacity",n=>D(n.target)?n.children?1:.8:0).attrTween("d",n=>()=>z(n.current)),Q.filter(function(n){return+this.getAttribute("fill-opacity")||S(n.target)}).transition(s).attr("fill-opacity",n=>+S(n.target)).attrTween("transform",n=>()=>Y(n.current)),event.stopPropagation(),setTimeout(()=>{if(e.depth){let n=[],u=ie(this);if(u.classed("focus"))return;let A=e.parent;for(;A.data.name!=="";){const ee={fieldName:A.data.dimension,value:A.data.name};A=A.parent,n.push(ee)}C=e.data.dimension,u.classed("focus",!0);let Z={fieldName:e.data.dimension,value:e.data.name};const _=[...n,Z];se(_)}else W()},450)}function W(){return C=null,me(".focus").classed("focus",!1),ce()}function D(e){return e.y1<=3&&e.y0>=1&&e.x1>e.x0}function S(e){return e.y1<=3&&e.y0>=1&&(e.y1-e.y0)*(e.x1-e.x0)>.03}function Y(e){const s=(e.x0+e.x1)/2*180/Math.PI,n=(e.y0+e.y1)/2*w;return`rotate(${s-90}) translate(${n},0) rotate(${s<180?0:180})`}}export{Ce as draw,Se as parse};
//# sourceMappingURL=sunburst-DcpBWESZ.js.map
