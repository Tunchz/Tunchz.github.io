import{m as st,n as ht}from"./set-BPvSEdwO.js";import{t as yt,i as gt,q as pt,T as vt,L as xr,u as dr,v as mt,k as Ur,o as Lt,w as fr}from"./_plugin-vue2_normalizer-xzsEtbse.js";import{l as xt}from"./index-CB7DGV00.js";import{a as dt,c as Pt}from"./main-CVmQxpd7.js";import{f as Fr}from"./defaultLocale-B8TAAL35.js";import{s as rr}from"./selectAll-Cx8JdGyI.js";import"./constant-I5scnKCP.js";import"./point-DWREGWZc.js";import"./index-BvYcEE5T.js";function br(r,e){return r<e?-1:r>e?1:r>=e?0:NaN}function Dt(r){return r.length===1&&(r=wt(r)),{left:function(e,u,c,a){for(c==null&&(c=0),a==null&&(a=e.length);c<a;){var n=c+a>>>1;r(e[n],u)<0?c=n+1:a=n}return c},right:function(e,u,c,a){for(c==null&&(c=0),a==null&&(a=e.length);c<a;){var n=c+a>>>1;r(e[n],u)>0?a=n:c=n+1}return c}}}function wt(r){return function(e,u){return br(r(e),u)}}Dt(br);function Mr(r){return r===null?NaN:+r}function Tr(r,e){var u=r.length,c=-1,a,n;if(e==null){for(;++c<u;)if((a=r[c])!=null&&a>=a)for(n=a;++c<u;)(a=r[c])!=null&&a>n&&(n=a)}else for(;++c<u;)if((a=e(r[c],c,r))!=null&&a>=a)for(n=a;++c<u;)(a=e(r[c],c,r))!=null&&a>n&&(n=a);return n}function Or(r,e){var u=r.length,c=u,a=-1,n,y=0;if(e==null)for(;++a<u;)isNaN(n=Mr(r[a]))?--c:y+=n;else for(;++a<u;)isNaN(n=Mr(e(r[a],a,r)))?--c:y+=n;if(c)return y/c}function Rr(r,e){var u=r.length,c=-1,a,n;if(e==null){for(;++c<u;)if((a=r[c])!=null&&a>=a)for(n=a;++c<u;)(a=r[c])!=null&&n>a&&(n=a)}else for(;++c<u;)if((a=e(r[c],c,r))!=null&&a>=a)for(n=a;++c<u;)(a=e(r[c],c,r))!=null&&n>a&&(n=a);return n}function Pr(r,e){var u=r.length,c=-1,a,n=0;if(e==null)for(;++c<u;)(a=+r[c])&&(n+=a);else for(;++c<u;)(a=+e(r[c],c,r))&&(n+=a);return n}var Et=Tt;function Tt(r){for(var e=r.length,u=new Array(e),c=new Array(e),a=new Array(e),n=new Array(e),y=new Array(e),s=new Array(e),t=0;t<e;++t)u[t]=-1,c[t]=0,a[t]=!1,n[t]=0,y[t]=-1,s[t]=[];var l=0,d=[],v=[];function g(w){var N=[w],S=[w];for(u[w]=c[w]=l,a[w]=!0,l+=1;S.length>0;){w=S[S.length-1];var x=r[w];if(n[w]<x.length){for(var b=n[w];b<x.length;++b){var C=x[b];if(u[C]<0){u[C]=c[C]=l,a[C]=!0,l+=1,N.push(C),S.push(C);break}else a[C]&&(c[w]=Math.min(c[w],c[C])|0);y[C]>=0&&s[w].push(y[C])}n[w]=b}else{if(c[w]===u[w]){for(var i=[],h=[],p=0,b=N.length-1;b>=0;--b){var m=N[b];if(a[m]=!1,i.push(m),h.push(s[m]),p+=s[m].length,y[m]=d.length,m===w){N.length=b;break}}d.push(i);for(var P=new Array(p),b=0;b<h.length;b++)for(var L=0;L<h[b].length;L++)P[--p]=h[b][L];v.push(P)}S.pop()}}}for(var t=0;t<e;++t)u[t]<0&&g(t);for(var E,t=0;t<v.length;t++){var f=v[t];if(f.length!==0){f.sort(function(N,S){return N-S}),E=[f[0]];for(var T=1;T<f.length;T++)f[T]!==f[T-1]&&E.push(f[T]);v[t]=E}}return{components:d,adjacencyList:v}}var bt=Et,Rt=function(e,u){var c=[],a=[],n=[],y={},s=[],t;function l(x){n[x]=!1,y.hasOwnProperty(x)&&Object.keys(y[x]).forEach(function(b){delete y[x][b],n[b]&&l(b)})}function d(x){var b=!1;a.push(x),n[x]=!0;var C,i;for(C=0;C<s[x].length;C++)i=s[x][C],i===t?(v(t,a),b=!0):n[i]||(b=d(i));if(b)l(x);else for(C=0;C<s[x].length;C++){i=s[x][C];var h=y[i];h||(h={},y[i]=h),h[i]=!0}return a.pop(),b}function v(x,b){var C=[].concat(b).concat(x);u?u(C):c.push(C)}function g(x){for(var b=0;b<e.length;b++)(b<x||!e[b])&&(e[b]=[]),e[b]=e[b].filter(function(C){return C>=x})}function E(x){g(x);for(var b=e,C=bt(b),i=C.components.filter(function(z){return z.length>1}),h=1/0,p,m=0;m<i.length;m++)for(var P=0;P<i[m].length;P++)i[m][P]<h&&(h=i[m][P],p=m);var L=i[p];if(!L)return!1;var R=e.map(function(z,G){return L.indexOf(G)===-1?[]:z.filter(function(F){return L.indexOf(F)!==-1})});return{leastVertex:h,adjList:R}}t=0;for(var f=e.length;t<f;){var T=E(t);if(t=T.leastVertex,s=T.adjList,s){for(var w=0;w<s.length;w++)for(var N=0;N<s[w].length;N++){var S=s[w][N];n[+S]=!1,y[S]={}}d(t),t=t+1}else t=f}if(!u)return c};const At=yt(Rt);function St(r,e){return r.sourceLinks.length?r.depth:e-1}function sr(r){return function(){return r}}var Br=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r};function It(r,e){return Ar(r.source,e.source)||r.index-e.index}function Nt(r,e){return Ar(r.target,e.target)||r.index-e.index}function Ar(r,e){return r.partOfCycle===e.partOfCycle?r.y0-e.y0:r.circularLinkType==="top"||e.circularLinkType==="bottom"?-1:1}function Dr(r){return r.value}function Sr(r){return(r.y0+r.y1)/2}function Ct(r){return Sr(r.source)}function Ft(r){return Sr(r.target)}function Mt(r){return r.index}function Ot(r){return r.nodes}function Bt(r){return r.links}function Vr(r,e){var u=r.get(e);if(!u)throw new Error("missing: "+e);return u}function X(r,e){return e(r)}var $=25,W=10,Vt=.3;function Ht(){var r=0,e=0,u=1,c=1,a=24,n,y=Mt,s=St,t=Ot,l=Bt,d=32,v=2,g,E=null;function f(){var i={nodes:t.apply(null,arguments),links:l.apply(null,arguments)};T(i),Xt(i,y,E),w(i),x(i),Hr(i,y),b(i,d,y),C(i);for(var h=4,p=0;p<h;p++)wr(i,c,y),Er(i,c,y),Ut(i,e,c,y),wr(i,c,y),Er(i,c,y);return Kt(i,e,c),Wr(i,v,c,y),i}f.nodeId=function(i){return arguments.length?(y=typeof i=="function"?i:sr(i),f):y},f.nodeAlign=function(i){return arguments.length?(s=typeof i=="function"?i:sr(i),f):s},f.nodeWidth=function(i){return arguments.length?(a=+i,f):a},f.nodePadding=function(i){return arguments.length?(n=+i,f):n},f.nodes=function(i){return arguments.length?(t=typeof i=="function"?i:sr(i),f):t},f.links=function(i){return arguments.length?(l=typeof i=="function"?i:sr(i),f):l},f.size=function(i){return arguments.length?(r=e=0,u=+i[0],c=+i[1],f):[u-r,c-e]},f.extent=function(i){return arguments.length?(r=+i[0][0],u=+i[1][0],e=+i[0][1],c=+i[1][1],f):[[r,e],[u,c]]},f.iterations=function(i){return arguments.length?(d=+i,f):d},f.circularLinkGap=function(i){return arguments.length?(v=+i,f):v},f.nodePaddingRatio=function(i){return arguments.length?(g=+i,f):g},f.sortNodes=function(i){return arguments.length?(E=i,f):E},f.update=function(i){return Hr(i,y),C(i),i.links.forEach(function(h){h.circular&&(h.circularLinkType=h.y0+h.y1<c?"top":"bottom",h.source.circularLinkType=h.circularLinkType,h.target.circularLinkType=h.circularLinkType)}),wr(i,c,y,!1),Er(i,c,y),Wr(i,v,c,y),i};function T(i){i.nodes.forEach(function(p,m){p.index=m,p.sourceLinks=[],p.targetLinks=[]});var h=st(i.nodes,y);return i.links.forEach(function(p,m){p.index=m;var P=p.source,L=p.target;(typeof P>"u"?"undefined":Br(P))!=="object"&&(P=p.source=Vr(h,P)),(typeof L>"u"?"undefined":Br(L))!=="object"&&(L=p.target=Vr(h,L)),P.sourceLinks.push(p),L.targetLinks.push(p)}),i}function w(i){i.nodes.forEach(function(h){h.partOfCycle=!1,h.value=Math.max(Pr(h.sourceLinks,Dr),Pr(h.targetLinks,Dr)),h.sourceLinks.forEach(function(p){p.circular&&(h.partOfCycle=!0,h.circularLinkType=p.circularLinkType)}),h.targetLinks.forEach(function(p){p.circular&&(h.partOfCycle=!0,h.circularLinkType=p.circularLinkType)})})}function N(i){var h=0,p=0,m=0,P=0,L=Tr(i.nodes,function(R){return R.column});return i.links.forEach(function(R){R.circular&&(R.circularLinkType=="top"?h=h+R.width:p=p+R.width,R.target.column==0&&(P=P+R.width),R.source.column==L&&(m=m+R.width))}),h=h>0?h+$+W:h,p=p>0?p+$+W:p,m=m>0?m+$+W:m,P=P>0?P+$+W:P,{top:h,bottom:p,left:P,right:m}}function S(i,h){var p=Tr(i.nodes,function(F){return F.column}),m=u-r,P=c-e,L=m+h.right+h.left,R=P+h.top+h.bottom,z=m/L,G=P/R;return r=r*z+h.left,u=h.right==0?u:u*z,e=e*G+h.top,c=c*G,i.nodes.forEach(function(F){F.x0=r+F.column*((u-r-a)/p),F.x1=F.x0+a}),G}function x(i){var h,p,m;for(h=i.nodes,p=[],m=0;h.length;++m,h=p,p=[])h.forEach(function(P){P.depth=m,P.sourceLinks.forEach(function(L){p.indexOf(L.target)<0&&!L.circular&&p.push(L.target)})});for(h=i.nodes,p=[],m=0;h.length;++m,h=p,p=[])h.forEach(function(P){P.height=m,P.targetLinks.forEach(function(L){p.indexOf(L.source)<0&&!L.circular&&p.push(L.source)})});i.nodes.forEach(function(P){P.column=Math.floor(s.call(null,P,m))})}function b(i,h,p){var m=ht().key(function(F){return F.column}).sortKeys(br).entries(i.nodes).map(function(F){return F.values});R(p),G();for(var P=1,L=h;L>0;--L)z(P*=.99,p),G();function R(F){if(g){var B=1/0;m.forEach(function(M){var O=c*g/(M.length+1);B=O<B?O:B}),n=B}var I=Rr(m,function(M){return(c-e-(M.length-1)*n)/Pr(M,Dr)});I=I*Vt,i.links.forEach(function(M){M.width=M.value*I});var H=N(i),U=S(i,H);I=I*U,i.links.forEach(function(M){M.width=M.value*I}),m.forEach(function(M){var O=M.length;M.forEach(function(D,q){D.depth==m.length-1&&O==1||D.depth==0&&O==1?(D.y0=c/2-D.value*I,D.y1=D.y0+D.value*I):D.partOfCycle?Xr(D,F)==0?(D.y0=c/2+q,D.y1=D.y0+D.value*I):D.circularLinkType=="top"?(D.y0=e+q,D.y1=D.y0+D.value*I):(D.y0=c-D.value*I-q,D.y1=D.y0+D.value*I):H.top==0||H.bottom==0?(D.y0=(c-e)/O*q,D.y1=D.y0+D.value*I):(D.y0=(c-e)/2-O/2+q,D.y1=D.y0+D.value*I)})})}function z(F,B){var I=m.length;m.forEach(function(H){var U=H.length,M=H[0].depth;H.forEach(function(O){var D;if((O.sourceLinks.length||O.targetLinks.length)&&!(O.partOfCycle&&Xr(O,B)>0))if(M==0&&U==1)D=O.y1-O.y0,O.y0=c/2-D/2,O.y1=c/2+D/2;else if(M==I-1&&U==1)D=O.y1-O.y0,O.y0=c/2-D/2,O.y1=c/2+D/2;else{var q=0,tr=Or(O.sourceLinks,Ft),er=Or(O.targetLinks,Ct);tr&&er?q=(tr+er)/2:q=tr||er;var ar=(q-Sr(O))*F;O.y0+=ar,O.y1+=ar}})})}function G(){m.forEach(function(F){var B,I,H=e,U=F.length,M;for(F.sort(Ar),M=0;M<U;++M)B=F[M],I=H-B.y0,I>0&&(B.y0+=I,B.y1+=I),H=B.y1+n;if(I=H-n-c,I>0)for(H=B.y0-=I,B.y1-=I,M=U-2;M>=0;--M)B=F[M],I=B.y1+n-H,I>0&&(B.y0-=I,B.y1-=I),H=B.y0})}}function C(i){i.nodes.forEach(function(h){h.sourceLinks.sort(Nt),h.targetLinks.sort(It)}),i.nodes.forEach(function(h){var p=h.y0,m=p,P=h.y1,L=P;h.sourceLinks.forEach(function(R){R.circular?(R.y0=P-R.width/2,P=P-R.width):(R.y0=p+R.width/2,p+=R.width)}),h.targetLinks.forEach(function(R){R.circular?(R.y1=L-R.width/2,L=L-R.width):(R.y1=m+R.width/2,m+=R.width)})})}return f}function Xt(r,e,u){var c=0;if(u===null){for(var a=[],n=0;n<r.links.length;n++){var y=r.links[n],s=y.source.index,t=y.target.index;a[s]||(a[s]=[]),a[t]||(a[t]=[]),a[s].indexOf(t)===-1&&a[s].push(t)}var l=At(a);l.sort(function(E,f){return E.length-f.length});var d={};for(n=0;n<l.length;n++){var v=l[n],g=v.slice(-2);d[g[0]]||(d[g[0]]={}),d[g[0]][g[1]]=!0}r.links.forEach(function(E){var f=E.target.index,T=E.source.index;f===T||d[T]&&d[T][f]?(E.circular=!0,E.circularLinkID=c,c=c+1):E.circular=!1})}else r.links.forEach(function(E){E.source[u]<E.target[u]?E.circular=!1:(E.circular=!0,E.circularLinkID=c,c=c+1)})}function Hr(r,e){var u=0,c=0;r.links.forEach(function(a){a.circular&&(a.source.circularLinkType||a.target.circularLinkType?a.circularLinkType=a.source.circularLinkType?a.source.circularLinkType:a.target.circularLinkType:a.circularLinkType=u<c?"top":"bottom",a.circularLinkType=="top"?u=u+1:c=c+1,r.nodes.forEach(function(n){(X(n,e)==X(a.source,e)||X(n,e)==X(a.target,e))&&(n.circularLinkType=a.circularLinkType)}))}),r.links.forEach(function(a){a.circular&&(a.source.circularLinkType==a.target.circularLinkType&&(a.circularLinkType=a.source.circularLinkType),nr(a,e)&&(a.circularLinkType=a.source.circularLinkType))})}function $r(r){var e=Math.abs(r.y1-r.y0),u=Math.abs(r.target.x0-r.source.x1);return Math.atan(u/e)}function Yt(r,e){return r.source.column<e.target.column?!1:!(r.target.column>e.source.column)}function Xr(r,e){var u=0;r.sourceLinks.forEach(function(a){u=a.circular&&!nr(a,e)?u+1:u});var c=0;return r.targetLinks.forEach(function(a){c=a.circular&&!nr(a,e)?c+1:c}),u+c}function Kr(r){var e=r.source.sourceLinks,u=0;e.forEach(function(n){u=n.circular?u+1:u});var c=r.target.targetLinks,a=0;return c.forEach(function(n){a=n.circular?a+1:a}),!(u>1||a>1)}function Yr(r,e,u){return r.sort(zt),r.forEach(function(c,a){var n=0;if(nr(c,u)&&Kr(c))c.circularPathData.verticalBuffer=n+c.width/2;else{var y=0;for(y;y<a;y++)if(Yt(r[a],r[y])){var s=r[y].circularPathData.verticalBuffer+r[y].width/2+e;n=s>n?s:n}c.circularPathData.verticalBuffer=n+c.width/2}}),r}function Wr(r,e,u,c){var a=5,n=Rr(r.links,function(t){return t.source.y0});r.links.forEach(function(t){t.circular&&(t.circularPathData={})});var y=r.links.filter(function(t){return t.circularLinkType=="top"});Yr(y,e,c);var s=r.links.filter(function(t){return t.circularLinkType=="bottom"});Yr(s,e,c),r.links.forEach(function(t){if(t.circular){if(t.circularPathData.arcRadius=t.width+W,t.circularPathData.leftNodeBuffer=a,t.circularPathData.rightNodeBuffer=a,t.circularPathData.sourceWidth=t.source.x1-t.source.x0,t.circularPathData.sourceX=t.source.x0+t.circularPathData.sourceWidth,t.circularPathData.targetX=t.target.x0,t.circularPathData.sourceY=t.y0,t.circularPathData.targetY=t.y1,nr(t,c)&&Kr(t))t.circularPathData.leftSmallArcRadius=W+t.width/2,t.circularPathData.leftLargeArcRadius=W+t.width/2,t.circularPathData.rightSmallArcRadius=W+t.width/2,t.circularPathData.rightLargeArcRadius=W+t.width/2,t.circularLinkType=="bottom"?(t.circularPathData.verticalFullExtent=t.source.y1+$+t.circularPathData.verticalBuffer,t.circularPathData.verticalLeftInnerExtent=t.circularPathData.verticalFullExtent-t.circularPathData.leftLargeArcRadius,t.circularPathData.verticalRightInnerExtent=t.circularPathData.verticalFullExtent-t.circularPathData.rightLargeArcRadius):(t.circularPathData.verticalFullExtent=t.source.y0-$-t.circularPathData.verticalBuffer,t.circularPathData.verticalLeftInnerExtent=t.circularPathData.verticalFullExtent+t.circularPathData.leftLargeArcRadius,t.circularPathData.verticalRightInnerExtent=t.circularPathData.verticalFullExtent+t.circularPathData.rightLargeArcRadius);else{var l=t.source.column,d=t.circularLinkType,v=r.links.filter(function(f){return f.source.column==l&&f.circularLinkType==d});t.circularLinkType=="bottom"?v.sort(Qr):v.sort(Jr);var g=0;v.forEach(function(f,T){f.circularLinkID==t.circularLinkID&&(t.circularPathData.leftSmallArcRadius=W+t.width/2+g,t.circularPathData.leftLargeArcRadius=W+t.width/2+T*e+g),g=g+f.width}),l=t.target.column,v=r.links.filter(function(f){return f.target.column==l&&f.circularLinkType==d}),t.circularLinkType=="bottom"?v.sort(Gt):v.sort(qt),g=0,v.forEach(function(f,T){f.circularLinkID==t.circularLinkID&&(t.circularPathData.rightSmallArcRadius=W+t.width/2+g,t.circularPathData.rightLargeArcRadius=W+t.width/2+T*e+g),g=g+f.width}),t.circularLinkType=="bottom"?(t.circularPathData.verticalFullExtent=Math.max(u,t.source.y1,t.target.y1)+$+t.circularPathData.verticalBuffer,t.circularPathData.verticalLeftInnerExtent=t.circularPathData.verticalFullExtent-t.circularPathData.leftLargeArcRadius,t.circularPathData.verticalRightInnerExtent=t.circularPathData.verticalFullExtent-t.circularPathData.rightLargeArcRadius):(t.circularPathData.verticalFullExtent=n-$-t.circularPathData.verticalBuffer,t.circularPathData.verticalLeftInnerExtent=t.circularPathData.verticalFullExtent+t.circularPathData.leftLargeArcRadius,t.circularPathData.verticalRightInnerExtent=t.circularPathData.verticalFullExtent+t.circularPathData.rightLargeArcRadius)}t.circularPathData.leftInnerExtent=t.circularPathData.sourceX+t.circularPathData.leftNodeBuffer,t.circularPathData.rightInnerExtent=t.circularPathData.targetX-t.circularPathData.rightNodeBuffer,t.circularPathData.leftFullExtent=t.circularPathData.sourceX+t.circularPathData.leftLargeArcRadius+t.circularPathData.leftNodeBuffer,t.circularPathData.rightFullExtent=t.circularPathData.targetX-t.circularPathData.rightLargeArcRadius-t.circularPathData.rightNodeBuffer}if(t.circular)t.path=Wt(t);else{var E=xt().source(function(f){var T=f.source.x0+(f.source.x1-f.source.x0),w=f.y0;return[T,w]}).target(function(f){var T=f.target.x0,w=f.y1;return[T,w]});t.path=E(t)}})}function Wt(r){var e="";return r.circularLinkType=="top"?e="M"+r.circularPathData.sourceX+" "+r.circularPathData.sourceY+" L"+r.circularPathData.leftInnerExtent+" "+r.circularPathData.sourceY+" A"+r.circularPathData.leftLargeArcRadius+" "+r.circularPathData.leftSmallArcRadius+" 0 0 0 "+r.circularPathData.leftFullExtent+" "+(r.circularPathData.sourceY-r.circularPathData.leftSmallArcRadius)+" L"+r.circularPathData.leftFullExtent+" "+r.circularPathData.verticalLeftInnerExtent+" A"+r.circularPathData.leftLargeArcRadius+" "+r.circularPathData.leftLargeArcRadius+" 0 0 0 "+r.circularPathData.leftInnerExtent+" "+r.circularPathData.verticalFullExtent+" L"+r.circularPathData.rightInnerExtent+" "+r.circularPathData.verticalFullExtent+" A"+r.circularPathData.rightLargeArcRadius+" "+r.circularPathData.rightLargeArcRadius+" 0 0 0 "+r.circularPathData.rightFullExtent+" "+r.circularPathData.verticalRightInnerExtent+" L"+r.circularPathData.rightFullExtent+" "+(r.circularPathData.targetY-r.circularPathData.rightSmallArcRadius)+" A"+r.circularPathData.rightLargeArcRadius+" "+r.circularPathData.rightSmallArcRadius+" 0 0 0 "+r.circularPathData.rightInnerExtent+" "+r.circularPathData.targetY+" L"+r.circularPathData.targetX+" "+r.circularPathData.targetY:e="M"+r.circularPathData.sourceX+" "+r.circularPathData.sourceY+" L"+r.circularPathData.leftInnerExtent+" "+r.circularPathData.sourceY+" A"+r.circularPathData.leftLargeArcRadius+" "+r.circularPathData.leftSmallArcRadius+" 0 0 1 "+r.circularPathData.leftFullExtent+" "+(r.circularPathData.sourceY+r.circularPathData.leftSmallArcRadius)+" L"+r.circularPathData.leftFullExtent+" "+r.circularPathData.verticalLeftInnerExtent+" A"+r.circularPathData.leftLargeArcRadius+" "+r.circularPathData.leftLargeArcRadius+" 0 0 1 "+r.circularPathData.leftInnerExtent+" "+r.circularPathData.verticalFullExtent+" L"+r.circularPathData.rightInnerExtent+" "+r.circularPathData.verticalFullExtent+" A"+r.circularPathData.rightLargeArcRadius+" "+r.circularPathData.rightLargeArcRadius+" 0 0 1 "+r.circularPathData.rightFullExtent+" "+r.circularPathData.verticalRightInnerExtent+" L"+r.circularPathData.rightFullExtent+" "+(r.circularPathData.targetY+r.circularPathData.rightSmallArcRadius)+" A"+r.circularPathData.rightLargeArcRadius+" "+r.circularPathData.rightSmallArcRadius+" 0 0 1 "+r.circularPathData.rightInnerExtent+" "+r.circularPathData.targetY+" L"+r.circularPathData.targetX+" "+r.circularPathData.targetY,e}function zt(r,e){return hr(r)==hr(e)?r.circularLinkType=="bottom"?Qr(r,e):Jr(r,e):hr(e)-hr(r)}function Jr(r,e){return r.y0-e.y0}function Qr(r,e){return e.y0-r.y0}function qt(r,e){return r.y1-e.y1}function Gt(r,e){return e.y1-r.y1}function hr(r){return r.target.column-r.source.column}function Zr(r){return r.target.x0-r.source.x1}function zr(r,e){var u=$r(r),c=Zr(e)/Math.tan(u),a=yr(r)=="up"?r.y1+c:r.y1-c;return a}function qr(r,e){var u=$r(r),c=Zr(e)/Math.tan(u),a=yr(r)=="up"?r.y1-c:r.y1+c;return a}function Ut(r,e,u,c){r.links.forEach(function(a){if(!a.circular&&a.target.column-a.source.column>1){var n=a.source.column+1,y=a.target.column-1,s=1,t=y-n+1;for(s=1;n<=y;n++,s++)r.nodes.forEach(function(l){if(l.column==n){var d=s/(t+1),v=Math.pow(1-d,3),g=3*d*Math.pow(1-d,2),E=3*Math.pow(d,2)*(1-d),f=Math.pow(d,3),T=v*a.y0+g*a.y0+E*a.y1+f*a.y1,w=T-a.width/2,N=T+a.width/2,S;w>l.y0&&w<l.y1?(S=l.y1-w+10,S=l.circularLinkType=="bottom"?S:-S,l=_(l,S,e,u),r.nodes.forEach(function(x){X(x,c)==X(l,c)||x.column!=l.column||$t(l,x)&&_(x,S,e,u)})):N>l.y0&&N<l.y1?(S=N-l.y0+10,l=_(l,S,e,u),r.nodes.forEach(function(x){X(x,c)==X(l,c)||x.column!=l.column||x.y0<l.y1&&x.y1>l.y1&&_(x,S,e,u)})):w<l.y0&&N>l.y1&&(S=N-l.y0+10,l=_(l,S,e,u),r.nodes.forEach(function(x){X(x,c)==X(l,c)||x.column!=l.column||x.y0<l.y1&&x.y1>l.y1&&_(x,S,e,u)}))}})}})}function $t(r,e){return r.y0>e.y0&&r.y0<e.y1||r.y1>e.y0&&r.y1<e.y1?!0:r.y0<e.y0&&r.y1>e.y1}function _(r,e,u,c){return r.y0+e>=u&&r.y1+e<=c&&(r.y0=r.y0+e,r.y1=r.y1+e,r.targetLinks.forEach(function(a){a.y1=a.y1+e}),r.sourceLinks.forEach(function(a){a.y0=a.y0+e})),r}function wr(r,e,u,c){r.nodes.forEach(function(a){c&&a.y+(a.y1-a.y0)>e&&(a.y=a.y-(a.y+(a.y1-a.y0)-e));var n=r.links.filter(function(t){return X(t.source,u)==X(a,u)}),y=n.length;y>1&&n.sort(function(t,l){if(!t.circular&&!l.circular){if(t.target.column==l.target.column)return t.y1-l.y1;if(_r(t,l)){if(t.target.column>l.target.column){var d=qr(l,t);return t.y1-d}if(l.target.column>t.target.column){var v=qr(t,l);return v-l.y1}}else return t.y1-l.y1}if(t.circular&&!l.circular)return t.circularLinkType=="top"?-1:1;if(l.circular&&!t.circular)return l.circularLinkType=="top"?1:-1;if(t.circular&&l.circular)return t.circularLinkType===l.circularLinkType&&t.circularLinkType=="top"?t.target.column===l.target.column?t.target.y1-l.target.y1:l.target.column-t.target.column:t.circularLinkType===l.circularLinkType&&t.circularLinkType=="bottom"?t.target.column===l.target.column?l.target.y1-t.target.y1:t.target.column-l.target.column:t.circularLinkType=="top"?-1:1});var s=a.y0;n.forEach(function(t){t.y0=s+t.width/2,s=s+t.width}),n.forEach(function(t,l){if(t.circularLinkType=="bottom"){var d=l+1,v=0;for(d;d<y;d++)v=v+n[d].width;t.y0=a.y1-v-t.width/2}})})}function Er(r,e,u){r.nodes.forEach(function(c){var a=r.links.filter(function(s){return X(s.target,u)==X(c,u)}),n=a.length;n>1&&a.sort(function(s,t){if(!s.circular&&!t.circular){if(s.source.column==t.source.column)return s.y0-t.y0;if(_r(s,t)){if(t.source.column<s.source.column){var l=zr(t,s);return s.y0-l}if(s.source.column<t.source.column){var d=zr(s,t);return d-t.y0}}else return s.y0-t.y0}if(s.circular&&!t.circular)return s.circularLinkType=="top"?-1:1;if(t.circular&&!s.circular)return t.circularLinkType=="top"?1:-1;if(s.circular&&t.circular)return s.circularLinkType===t.circularLinkType&&s.circularLinkType=="top"?s.source.column===t.source.column?s.source.y1-t.source.y1:s.source.column-t.source.column:s.circularLinkType===t.circularLinkType&&s.circularLinkType=="bottom"?s.source.column===t.source.column?s.source.y1-t.source.y1:t.source.column-s.source.column:s.circularLinkType=="top"?-1:1});var y=c.y0;a.forEach(function(s){s.y1=y+s.width/2,y=y+s.width}),a.forEach(function(s,t){if(s.circularLinkType=="bottom"){var l=t+1,d=0;for(l;l<n;l++)d=d+a[l].width;s.y1=c.y1-d-s.width/2}})})}function _r(r,e){return yr(r)==yr(e)}function yr(r){return r.y0-r.y1>0?"up":"down"}function nr(r,e){return X(r.source,e)==X(r.target,e)}function Kt(r,e,u){var c=r.nodes,a=r.links,n=!1,y=!1;if(a.forEach(function(g){g.circularLinkType=="top"?n=!0:g.circularLinkType=="bottom"&&(y=!0)}),n==!1||y==!1){var s=Rr(c,function(g){return g.y0}),t=Tr(c,function(g){return g.y1}),l=t-s,d=u-e,v=d/l;c.forEach(function(g){var E=(g.y1-g.y0)*v;g.y0=(g.y0-s)*v,g.y1=g.y0+E}),a.forEach(function(g){g.y0=(g.y0-s)*v,g.y1=(g.y1-s)*v,g.width=g.width*v})}}function ue(r,e,u,c){let a=new Map,n=new Map;c.extraSettings[11],gt()&&r.reverse();let y=c.dimensions[0],s=c.dimensions[1],t=e[0],l=e[1],d=u,v=1;for(let f of r){let T=f[t].formattedValue,w=f[l].formattedValue,N=pt(f,d);if(Number.isNaN(N))throw new Error("The selected measure contains non-numeric values.");if(N<=0)throw new Error("The selected measure contains values smaller than or equal to 0.");n.has(T)||(n.set(T,{name:T,dimension:y,id:T,orderBy:v.toString()}),v++),n.has(w)||(n.set(w,{name:w,dimension:s,id:w,orderBy:v.toString()}),v++);let S=T+w;a.has(S)&&(N+=a.get(S).value),a.set(S,{source:T,target:w,value:N})}let g=Array.from(n.values()),E=Array.from(a.values());return{nodes:g,links:E}}let Ir=null;function ne(r,e,u){let{measureName:c,measureFormat:a,measureStyle:n,color:y,isDarkTheme:s,width:t,height:l,mixBlendMode:d,fontSize:v,extraSettings:g,dimensionColors:E,memberColors:f,useNewColorFormat:T,enableLegend:w,legendPosition:N,legendRows:S,legendColumns:x,legendPaddingX:b,legendPaddingY:C,legendType:i,scaleLegendItems:h,scaleLegendColor:p,scaleLegendOrder:m}=u;const P=new vt("#tooltip",t,l);let L=g[0]||"value",R=g[1]||"circular",z=parseInt(g[2])||100,G=(parseInt(g[3])||10)/100,F=parseInt(g[4])||0,B=(parseFloat(g[5])+1||50)/100,I=(parseFloat(g[6])+1||100)/100,H=g[7]==="1"?1:0,U=g[8]==="0"?0:1,M=g[9]||"inside",O=parseFloat(g[11])*10||0,D=parseFloat(g[12])*10||0,q=parseFloat(g[13])*10||0,tr=parseFloat(g[14])*10||0,er=g[15]||(u!=null&&u.textColor?u.textColor:"#ffffff"),ar=g[16]||(u!=null&&u.textColorLinks?u.textColorLinks:"#ffffff"),tt=g[17]||"#333333",et=g[18]||"#dddddd",at=g[19]||"#ff0000";a||(a=",.0f");let K=Fr(a);n&&(K=Lt(n));let J=Fr(".1%"),ir=5,Nr=ir,pr=t-ir,vr=l-ir;w&&(N==="left"&&(Nr+=x*100+35),N==="right"&&(pr-=x*100+45),N==="bottom"&&(vr-=S*18+40));let ct=Ht().circularLinkGap(5).nodeWidth(z).nodePaddingRatio(G).iterations(32).nodeId(o=>o.name).extent([[Nr+O,ir+q],[pr-D,vr-tr]]);if(w){let o=w&&N==="right"?pr+20:10,A=w&&N==="bottom"?vr+25:20;if(o+=parseInt(b),A+=parseInt(C),i==="color"){if(L==="value")new xr(r,e.nodes,s).title(u.legendTitle?u.legendTitle:"Dimensions").text(V=>V.name).offset(o,A).positioning(N).nrRows(S).nrColumns(x).color(V=>{if(T){for(var Y=0;Y<f.length;Y++)if(f[Y].fieldName===V)return f[Y].color}else return y(V)}).highlight(j).clearHighlight(k).draw();else if(L==="none"){let V=["All"];new xr(r,V,s).title(u.legendTitle?u.legendTitle:"Dimensions").text(Y=>Y).offset(o,A).positioning(N).nrRows(S).nrColumns(x).color(Y=>T?E[0].color:y(Y)).highlight(j).clearHighlight(k).draw()}}else i==="scale"&&(async()=>{for(;!e.links[0].width;)await new Promise(lr=>setTimeout(lr,100));let V=e.links[0].value/e.links[0].width;for(var Y=9999999,ur=0,Q=0;Q<e.links.length;Q++)e.links[Q].value<Y&&(Y=e.links[Q].value),e.links[Q].value>ur&&(ur=e.links[Q].value);var or=[];let lt=ur-Y,Lr=h,ft=lt/(Lr-1);for(var Z=0;Z<Lr;Z++)or[Z]=Z===0?fr(Y):Z===Lr-1?fr(ur):fr(Y+ft*Z);h==="1"&&(or[0]=fr(ur)),m==="high-low"&&or.reverse(),new xr(r,or,s).title(u.legendTitle?u.legendTitle:"Scale legend").text(lr=>lr.name).offset(o,A).positioning(N).nrRows(S).nrColumns(x).legendType("scale").setPixelValue(V).color(lr=>p).highlight(j).clearHighlight(k).draw()})()}r.on("click",jr);let ut=r.append("g").attr("class","links").attr("fill","none").attr("stroke-opacity",B),nt=r.append("g").attr("class","nodes").attr("font-size",v+"rem"),Cr=ct(e),it=Cr.nodes,ot=Cr.links,mr=nt.selectAll(".node").data(it).enter().append("g").attr("class","node");mr.append("rect").attr("x",o=>o.x0+F).attr("y",o=>o.y0).attr("stroke-width",o=>H?1:0).attr("stroke",tt).attr("fill-opacity",I).attr("width",o=>o.x1-o.x0-F*2).attr("fill",o=>{if(T)if(L==="value"){for(var A=0;A<f.length;A++)if(f[A].fieldName===o.name)return f[A].color}else return E[0].color;else return y(L==="value"?o.name:o.dimension)}).classed("focus",o=>o.dimension===Ir).on("click",Jt).on("mouseover",o=>{P.show(u.tooltips.node.content||u.tooltips.node,{DimensionValue:o.name.bold(),DimensionName:o.dimension,MeasureName:c,MeasureValue:K(o.value).bold()}),j(o)}).on("mousemove",()=>{P.updatePosition()}).on("mouseout",()=>{P.hide(),k()}),mr.selectAll("rect").attr("height",o=>o.y1-o.y0);let cr=ut.selectAll(".link").data(ot).enter().append("g").attr("class","link").style("mix-blend-mode",d);if(R==="both"){let o=cr.append("linearGradient").attr("id",A=>`link-${A.index}`).attr("gradientUnits","userSpaceOnUse").attr("x1",A=>A.source.x1).attr("x2",A=>A.target.x0);o.append("stop").attr("offset","0%").attr("stop-color",A=>{if(T)if(L==="value"){for(var V=0;V<f.length;V++)if(f[V].fieldName===A.source.name)return f[V].color}else return E[0].color;else return y(L==="unique"?A.source.id:L==="value"?A.source.name:A.source.dimension)}),o.append("stop").attr("offset","100%").attr("stop-color",A=>{if(T)if(L==="value"){for(var V=0;V<f.length;V++)if(f[V].fieldName===A.target.name)return f[V].color}else return E[0].color;else return y(L==="unique"?A.target.id:L==="value"?A.target.name:A.target.dimension)})}cr.append("path").attr("class","link").attr("d",function(o){return o.path}).style("stroke",o=>{if(R==="circular")return o.circular?at:et;if(R==="both")return`url(#link-${o.index})`;if(R==="input")if(T)if(L==="value"){for(var A=0;A<f.length;A++)if(f[A].fieldName===o.source.name)return f[A].color}else return E[0].color;else return y(L==="unique"?o.source.id:L==="value"?o.source.name:o.source.dimension);else if(R==="output")if(T)if(L==="value"){for(var A=0;A<f.length;A++)if(f[A].fieldName===o.target.name)return f[A].color}else return E[0].color;else return y(L==="unique"?o.target.id:L==="value"?o.target.name:o.target.dimension)}).on("mouseover",o=>{j(o),P.show(u.tooltips.link.content||u.tooltips.link,{MeasureName:c,MeasureValue:K(o.value).bold(),PercentOfSource:J(o.value/o.source.value).bold(),SourceName:o.source.name.bold(),PercentOfTarget:J(o.value/o.target.value).bold(),TargetName:o.target.name.bold()})}).on("mousemove",()=>{P.updatePosition()}).on("mouseout",()=>{P.hide(),k()}),cr.selectAll("path").attr("stroke-width",o=>Math.max(1,o.width)),u.labels.fromLink.enabled&&cr.append("foreignObject").attr("width",300).attr("height",300).filter(o=>o.width>16).attr("x",function(o){return o.source.x1+2}).attr("y",function(o){return o.y0-8*v}).style("pointer-events","none").attr("color",ar).html(function(o){return dr(u.labels.fromLink.content,{MeasureName:c,MeasureValue:K(o.value),PercentOfSource:J(o.value/o.source.value),SourceName:o.source.name,PercentOfTarget:J(o.value/o.target.value),TargetName:o.target.name})}),u.labels.toLink.enabled&&cr.append("foreignObject").attr("width",300).attr("height",300).filter(o=>o.width>16).attr("x",function(o){return o.target.x0-300-2}).attr("y",function(o){return o.y1-8*v}).style("pointer-events","none").attr("color",ar).html(function(o){return'<div style="text-align: right">'+dr(u.labels.toLink.content,{MeasureName:c,MeasureValue:K(o.value),PercentOfSource:J(o.value/o.source.value),SourceName:o.source.name,PercentOfTarget:J(o.value/o.target.value),TargetName:o.target.name})+"</div>"}),(U&&u.labels.node.enabled||u.labels.node.enabled)&&(mr.append("foreignObject").attr("width",o=>o.x1-o.x0-F*2-10).attr("x",o=>M==="outside"?o.x0-F-5:o.x0+F+5).attr("height",o=>o.y1-o.y0).attr("y",o=>o.y0+5).attr("dy","0.35em").attr("text-anchor",M==="outside"?"end":"start").style("pointer-events","none").attr("color",er).html(function(o){return dr(u.labels.node.content,{DimensionName:o.dimension,DimensionValue:o.name,MeasureName:c,MeasureValue:K(o.value)})}).attr("x",o=>M==="outside"?o.x1+F+5:o.x1-z+F+5).attr("text-anchor","start"),M==="inside"&&rr("text").call(Qt,z-10-F*2))}const Jt=async function(e){mt.stopPropagation();let u=Ur(this),c=u.classed("focus");await jr(),!c&&(Ir=e.dimension,u.classed("focus",!0),j(e,{fixHighlight:!0}),dt(e.dimension,e.name))};function jr(){return Ir=null,rr(".focus").classed("focus",!1),k({unfixHighlight:!0}),Pt()}let gr;function j(r,{fixHighlight:e=!1}={}){gr||(rr(".node").style("opacity",u=>Gr(r,u)?1:.4),rr(".link").style("opacity",u=>Gr(r,u)?1:.6),e&&(gr=!0))}function k({unfixHighlight:r=!1}={}){r&&(gr=!1),!gr&&(rr(".node").style("opacity",1),rr(".link").style("opacity",1))}function Gr(r,e){return!!(e===r||r.source===e||r.target===e||kr(r,e)||rt(r,e))}function kr(r,e){r=r.source?r.source:r;let u=e.target?[e.target]:e.sourceLinks.map(c=>c.target);return u.includes(r)?!0:u.some(c=>kr(r,c))}function rt(r,e){r=r.target?r.target:r;let u=e.source?[e.source]:e.targetLinks.map(c=>c.source);return u.includes(r)?!0:u.some(c=>rt(r,c))}function Qt(r,e){r.each(function(){let u=Ur(this),c=u.text().split(/\s+/).reverse(),a,n=[],y=u.attr("y"),s=parseFloat(u.attr("dy")),t=u.text(null).append("tspan").attr("y",y).attr("dx",0),l=[t];setTimeout(()=>{for(;a=c.pop();)if(n.push(a),t.text(n.join(" ")),t.node().getComputedTextLength()>e){n.pop(),t.text(n.join(" ")),n=[a];let v=t.node().getComputedTextLength();t=u.append("tspan").attr("y",y).attr("dx",v*-1).text(a),l.push(t)}if(l.length<=1)return;let d=-(l.length-1)/2;for(let v=0;v<l.length;v++){let g=l[v],E=d+v+s;g.attr("dy",E+"em")}},0)})}export{ne as draw,ue as parse};
//# sourceMappingURL=circular-sankey-nlFW7KXO.js.map
