import{z as Ve}from"./zoom-BnyqM2yK.js";import{T as ve,L as Ne,v as M,k as Me,o as Le}from"./_plugin-vue2_normalizer-xzsEtbse.js";import{o as $e,a as we,c as Ae}from"./main-CVmQxpd7.js";import{f as Ce}from"./defaultLocale-B8TAAL35.js";import{s as Ie,j as Fe,f as De,a as Se,d as Te,b as Pe,e as ze,i as Be}from"./manyBody-hrwLCHaU.js";import{s as Ee}from"./selectAll-Cx8JdGyI.js";import"./index-BNR9-8HJ.js";import"./touch-Dr12ZUMz.js";import"./index-BvYcEE5T.js";import"./math-CBKwitpL.js";import"./constant-I5scnKCP.js";function Ke(d,n,f,g){let L=g.dimensions[0],$=g.dimensions[1],D=g.dimensions[2],k=n[0],w=n[1],y=n[2],i=n[3],V=n[4],a=-1/0,p=-1/0,s={},h=[];for(let l of d){let o=l[k].formattedValue,x=l[w].formattedValue,u=parseFloat(l[f].value);if(Number.isNaN(u))throw new Error("The selected measure contains non-numeric values.");x!=="Null"&&(Math.abs(u)>a&&(a=Math.abs(u)),h.push({source:o,target:x,value:u}))}for(let l of d){let o=l[k].formattedValue,x=y!=null?l[y].formattedValue:"noGroup",u=i!=null?l[i].formattedValue:"noSymbol",A=V!=null?l[V].formattedValue:"noUrl",c=parseFloat(l[f].value);if(Math.abs(c)>p&&(p=Math.abs(c)),!s[o]||s[o]===o)s[o]={name:o,group:x,fromValue:c,toValue:0,symbol:u,url:A};else{let v=c+s[o].fromValue;s[o].fromValue=v}}for(let l of d){let o=l[w].formattedValue,x=y!=null?l[y].formattedValue:"noGroup",u=i!=null?l[i].formattedValue:"noSymbol",A=V!=null?l[V].formattedValue:"noUrl",c=parseFloat(l[f].value);if(Math.abs(c)>p&&(p=Math.abs(c)),o!=="Null")if(!s[o]||s[o]===o)s[o]={name:o,group:x,fromValue:0,toValue:c,symbol:u,url:A};else{let v=c+s[o].toValue;s[o].toValue=v}}let I=Object.entries(s).map(l=>({name:l[1].name,group:l[1].group,symbol:l[1].symbol,url:l[1].url,sourceDim:L,targetDim:$,groupDim:D,fromValue:l[1].fromValue,toValue:l[1].toValue}));return{links:h,nodes:I,maxLinkValue:a,maxNodeValue:p}}let R=null;function Qe(d,n,f){let{color:g,width:L,height:$,measureName:D,measureFormat:k,measureStyle:w,filterDimension:y,extraSettings:i,isDarkTheme:V,memberColors:a,useNewColorFormat:p,enableLegend:s,legendPosition:h,legendRows:I,legendColumns:l,legendPaddingX:o,legendPaddingY:x}=f;const u=new ve("#tooltip",L,$);let A=n.maxLinkValue,c=n.maxNodeValue,v=i[0]==="0"?"nodesAndLinks":"nodes",U=i[1]!=="0",ae=i[2]!=="0",X=i[3]!=="0",Y=i[4]==="0"?"fromValue":"toValue",ne=i[5]||75,ie=i[6]||10,j=i[7]||1,se=i[8]||1,ue=i[9]||300,S=n.nodes[1].url!=="noUrl",fe=i[10]||(f!=null&&f.textColor?f.textColor:"#ffffff");d.on("click",Z),k||(k=".1f");let q=Ce(k);w&&(q=Le(w));let me=Ie(),H=$e(Fe),C=De(n.nodes).force("link",Se(n.links).id(e=>e.name).distance(ne)).force("collide",Te(ie)).force("charge",Pe()).force("center",ze(L/2,$/2));U?C.on("tick",_):C.stop();let O=d.append("svg:defs"),W=5,J=L-W,K=$-W;if(s&&(h==="right"&&(J-=l*100+45),h==="bottom"&&(K-=I*18+20)),s){let e=s&&h==="right"?J:10,t=s&&h==="bottom"?K:20;e+=parseInt(o),t+=parseInt(x),new Ne(d,a,V).title(f.legendTitle?f.legendTitle:"Color Legend").text(m=>m.fieldName).offset(e,t).positioning(h).nrRows(I).nrColumns(l).color(m=>{if(p){for(var r=0;r<a.length;r++)if(a[r].fieldName===m)return a[r].color}else return g(m)}).draw()}S&&O.selectAll("pattern").data(n.nodes).enter().append("svg:pattern").attr("id",e=>`img${e.name.replace(/\s/g,"").toLowerCase()}`).attr("viewBox","0 0 5 5").attr("width","5").attr("height","5").append("svg:image").attr("xlink:href",e=>e.url).attr("width","1").attr("height","1"),X&&O.selectAll("marker").data(["end"]).enter().append("svg:marker").attr("id",e=>e).attr("viewBox","-10 -5 10 10").attr("refX","-2px").attr("refY",0).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto-start-reverse").append("svg:path").attr("fill","#999").attr("fill-opacity",1).attr("d","M-10,-5L0,0L-10,5");let F=d.append("g"),T=F.append("g").attr("class","links").selectAll("path").data(n.links).enter().append("path").attr("marker-end","url(#end)").attr("fill","none").attr("stroke",e=>{if(v==="nodesAndLinks")if(p){for(var t=0;t<a.length;t++)if(a[t].fieldName==e.source.group)return a[t].color}else return g(e.source.group);else return"#999"}).attr("stroke-opacity",.6).attr("stroke-width",e=>.5+Math.abs(e.value)/A*2*se).on("mouseover",e=>{u.show(f.tooltips.link.content||f.tooltips.link,{SourceName:e.source.name.bold(),TargetName:e.target.name.bold(),MeasureName:D,MeasureValue:q(e.value).bold()})}).on("mousemove",()=>{u.updatePosition()}).on("mouseout",()=>{u.hide()}),P=F.append("g").attr("class","nodes").selectAll("path").data(n.nodes).enter().append("path").attr("d",me.type(e=>e.symbol!=="-1"?H(e.symbol):H(1)).size(e=>Math.PI*(5+Math.abs(e[Y])/c*3*j)**2)).attr("fill",e=>{if(S&&e.url!="Null")return`url(#img${e.name.replace(/\s/g,"").toLowerCase()})`;if(p){for(var t=0;t<a.length;t++)if(a[t].fieldName==e.group)return a[t].color}else return g(e.group)}).attr("id",e=>e.name).attr("stroke",e=>{if(S&&v=="nodesAndLinks")if(p){for(var t=0;t<a.length;t++)if(a[t].fieldName==e.group)return a[t].color}else return g(e.group);else return"#f1f1f1"}).attr("stroke-width",1).classed("focus",e=>e.name===R).call(Be().on("start",ge).on("drag",he).on("end",xe)).on("click",ce).on("mouseover",e=>{u.show(f.tooltips.node.content||f.tooltips.node,{Name:e.name.bold(),Dimension:e.groupDim,Group:e.group.bold()})}).on("mousemove",()=>{u.updatePosition()}).on("mouseout",()=>{u.hide()}),z=F.append("g").attr("class","labelNodes").selectAll("text").data(n.nodes).enter().append("text").text(e=>e.name).attr("display","none").style("fill",fe).style("text-anchor","middle").style("pointer-events","none");d.call(Ve().scaleExtent([.1,6]).on("zoom",()=>F.attr("transform",M.transform))),d.on("dblclick.zoom",null);var B=[];n.links.forEach(function(e){B[e.source.index+"-"+e.target.index]=!0,B[e.target.index+"-"+e.source.index]=!0});function Q(e,t){return e==t||B[e+"-"+t]}function ce(e){M.stopPropagation();let t=Me(this),m=t.classed("focus");Z(),!m&&(R=y,t.classed("focus",!0),y.forEach(function(r){let b=e[r.toLowerCase()+"Dim"];we(b,e.name)}),P.style("opacity",function(r){return Q(e.index,r.index)?1:.1}),z.attr("display",function(r){return Q(e.index,r.index)?"block":"none"}),T.style("opacity",function(r){return r.source.index===e.index||r.target.index===e.index?1:.1}))}function Z(){return Ee(".focus").classed("focus",!1),z.attr("display","none"),P.style("opacity",1),T.style("opacity",1),R=null,Ae()}function _(){P.call(pe),T.call(de),z.each(function(e){this.setAttribute("transform",`translate(${e.x},${e.y+20})`)})}function de(e){e.attr("d",function(t){let m=t.target.x-t.source.x,r=t.target.y-t.source.y,b=Math.sqrt(m*m+r*r);return`M${t.source.x},${t.source.y} A${b},${b} 0 0,1 ${t.target.x},${t.target.y}`}),e.attr("d",function(t){let m=t.source.x,r=t.source.y,b=t.target.x,ee=t.target.y,E=X?7+Math.abs(t.target[Y])/c*3*j*1.5:0;if(ae){let G=this.getTotalLength(),N=this.getPointAtLength(G-E),le=N.x-m,re=N.y-r,oe=Math.sqrt(le*le+re*re);return`M${m},${r}A${oe},${oe} 0 0,1 ${N.x},${N.y}`}else{let G=b-m,N=ee-r;var te=Math.atan2(N,G),be=b-Math.cos(te)*E,ke=ee-Math.sin(te)*E;return`M${m},${r} ${be},${ke}`}})}function pe(e){e.attr("transform",t=>`translate(${t.x},${t.y})`)}function ge(e){M.active||C.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}function he(e){u.updatePosition(),e.fx=M.x,e.fy=M.y}function xe(e){M.active||C.alphaTarget(0),e.fx=null,e.fy=null}function ye(){for(var e=0;e<ue;++e)C.tick();_()}U||ye()}export{Qe as draw,Ke as parse};
//# sourceMappingURL=network-diagram-CDsSPKHA.js.map
