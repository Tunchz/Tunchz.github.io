import{S as K,s as Q,a as X}from"./index-S46iqhiS.js";import{l as Y,T as Z,v as _,k as z}from"./_plugin-vue2_normalizer-xzsEtbse.js";import{a as ee,c as te}from"./main-CVmQxpd7.js";import{f as B}from"./defaultLocale-B8TAAL35.js";import{s as k}from"./selectAll-Cx8JdGyI.js";import"./min-D1slsF82.js";import"./sum-CB6J5KXz.js";import"./max-DBeXZoyG.js";import"./index-CB7DGV00.js";import"./constant-I5scnKCP.js";import"./point-DWREGWZc.js";import"./index-BvYcEE5T.js";const M="%||%";function xe(t,a,n,o){let c=new Map,s=new Set,g=o.extraSettings[11]==="0"?0:1;for(let i=1;i<a.length;i++)for(let m of t){let r=o.dimensions[i-1],f=o.dimensions[i],u=a[i-1],h=a[i],v=m[u].formattedValue,P=m[h].formattedValue;if(g&&Y(m[h]))continue;let p=r+M+v,w=f+M+P,y=parseFloat(m[n].value);if(Number.isNaN(y))throw new Error("The selected measure contains non-numeric values.");y<=0&&(y=0);let b=p+w;c.has(b)&&(y+=c.get(b).value),s.add(p).add(w),c.set(b,{source:p,target:w,value:y})}let x=Array.from(s,i=>{let[m,r]=i.split(M);return{dimension:m,name:r,id:i}}),d=Array.from(c.values());return{nodes:x,links:d}}let A=null;function he(t,a,n){let{measureName:o,measureFormat:c,color:s,width:g,height:x,mixBlendMode:d,textColor:i,fontSize:m,extraSettings:r}=n;const f=new Z("#tooltip",g,x);let u=r[0]||"value",h=r[1]||"both",v=parseInt(r[2])||100,P=parseInt(r[3])||0,p=parseInt(r[4])||0,w=(parseFloat(r[5])||50)/100,y=(parseFloat(r[6])||100)/100,b=r[7]||"sankeyLeft",j=r[8]==="1"?1:0,U=r[9]==="0"?0:1,N=r[10]||"inside",I=r[12]||"auto",V=new Intl.Collator(void 0,{usage:"sort"}).compare;c||(c=",.0f");let q=B(c),O=B(".1%"),S=5,W=K().nodeAlign(Q[b]).nodeWidth(v).nodePadding(Math.max(P,x*.02)).nodeSort(function(e,l){if(I==="asc")return V(e.name,l.name);if(I==="desc")return V(l.name,e.name)}).nodeId(e=>e.id).extent([[S,S],[g-S,x-S]]);t.on("click",E);let $=t.append("g").attr("class","links").attr("fill","none").attr("stroke-opacity",w),J=t.append("g").attr("class","nodes").attr("font-size",m+"rem");W(a);let D=J.selectAll(".node").data(a.nodes).enter().append("g").attr("class","node");D.append("rect").attr("x",e=>e.x0+p).attr("y",e=>e.y0).attr("stroke-width",e=>j?1:0).attr("stroke","#333").attr("fill-opacity",y).attr("height",e=>e.y1-e.y0).attr("width",e=>e.x1-e.x0-p*2).attr("fill",e=>s(u==="unique"?e.id:u==="value"?e.name:e.dimension)).classed("focus",e=>e.dimension===A).on("click",ae).on("mouseover",e=>{f.show(n.tooltips.node.content||n.tooltips.node,{DimensionName:e.dimension,DimensionValue:e.name.bold(),MeasureName:o,MeasureValue:q(e.value).bold()}),F(e)}).on("mousemove",()=>{f.updatePosition()}).on("mouseout",()=>{f.hide(),L()});let H=$.selectAll(".link").data(a.links).enter().append("g").attr("class","link").style("mix-blend-mode",d);if(h==="both"){let e=H.append("linearGradient").attr("id",l=>`link-${l.index}`).attr("gradientUnits","userSpaceOnUse").attr("x1",l=>l.source.x1).attr("x2",l=>l.target.x0);e.append("stop").attr("offset","0%").attr("stop-color",l=>s(u==="unique"?l.source.id:u==="value"?l.source.name:l.source.dimension)),e.append("stop").attr("offset","100%").attr("stop-color",l=>s(u==="unique"?l.target.id:u==="value"?l.target.name:l.target.dimension))}H.append("path").attr("class","link").attr("d",X()).attr("stroke",e=>h==="none"?"#ddd":h==="both"?`url(#link-${e.index})`:s(h==="input"?u==="unique"?e.source.id:u==="value"?e.source.name:e.source.dimension:u==="unique"?e.target.id:u==="value"?e.target.name:e.target.dimension)).attr("stroke-width",e=>Math.max(1,e.width)).on("mouseover",e=>{f.show(n.tooltips.link.content||n.tooltips.link,{MeasureName:o,MeasureValue:q(e.value).bold(),PercentOfSource:O(e.value/e.source.value).bold(),SourceName:e.source.name.bold(),PercentOfTarget:O(e.value/e.target.value).bold(),TargetName:e.target.name.bold()}),F(e)}).on("mousemove",()=>{f.updatePosition()}).on("mouseout",()=>{f.hide(),L()}),U&&(D.append("text").attr("x",e=>N==="outside"?e.x0-p-5:e.x0+p+5).attr("y",e=>(e.y1+e.y0)/2).attr("dy","0.35em").attr("text-anchor",N==="outside"?"end":"start").style("pointer-events","none").attr("fill",i).text(e=>e.name).filter(e=>e.x0<g/2).attr("x",e=>N==="outside"?e.x1+p+5:e.x1-v+p+5).attr("text-anchor","start"),N==="inside"&&k("text").call(ne,v-10-p*2))}const ae=async function(a){_.stopPropagation();let n=z(this),o=n.classed("focus");await E(),!o&&(A=a.dimension,n.classed("focus",!0),F(a,{fixHighlight:!0}),ee(a.dimension,a.name))};function E(){return A=null,k(".focus").classed("focus",!1),L({unfixHighlight:!0}),te()}let T;function F(t,{fixHighlight:a=!1}={}){T||(k(".node").style("opacity",n=>C(t,n)?1:.4),k(".link").style("opacity",n=>C(t,n)?1:.6),a&&(T=!0))}function L({unfixHighlight:t=!1}={}){t&&(T=!1),!T&&(k(".node").style("opacity",1),k(".link").style("opacity",1))}function C(t,a){return!!(a===t||t.source===a||t.target===a||G(t,a)||R(t,a))}function G(t,a){t=t.source?t.source:t;let n=a.target?[a.target]:a.sourceLinks.map(o=>o.target);return n.includes(t)?!0:n.some(o=>G(t,o))}function R(t,a){t=t.target?t.target:t;let n=a.source?[a.source]:a.targetLinks.map(o=>o.source);return n.includes(t)?!0:n.some(o=>R(t,o))}function ne(t,a){t.each(function(){let n=z(this),o=n.text().split(/\s+/).reverse(),c,s=[],g=n.attr("y"),x=parseFloat(n.attr("dy")),d=n.text(null).append("tspan").attr("y",g).attr("dx",0),i=[d];setTimeout(()=>{for(;c=o.pop();)if(s.push(c),d.text(s.join(" ")),d.node().getComputedTextLength()>a){s.pop(),d.text(s.join(" ")),s=[c];let r=d.node().getComputedTextLength();d=n.append("tspan").attr("y",g).attr("dx",r*-1).text(c),i.push(d)}if(i.length<=1)return;let m=-(i.length-1)/2;for(let r=0;r<i.length;r++){let f=i[r],u=m+r+x;f.attr("dy",u+"em")}},0)})}export{he as draw,xe as parse};
//# sourceMappingURL=sankey-diagram-original-C0iVF7EC.js.map
