import{S as mt,s as ht,a as pt}from"./index-S46iqhiS.js";import{i as gt,z as vt}from"./zoom-BnyqM2yK.js";import{l as je,q as _,T as xt,J as yt,i as Nt,u as Ie,L as pe,v as He,k as xe,o as Ge,K as kt,w as ge}from"./_plugin-vue2_normalizer-xzsEtbse.js";import{e as bt,f as wt,g as Tt}from"./main-CVmQxpd7.js";import{f as Pe}from"./defaultLocale-B8TAAL35.js";import{s as $}from"./selectAll-Cx8JdGyI.js";import"./min-D1slsF82.js";import"./sum-CB6J5KXz.js";import"./max-DBeXZoyG.js";import"./index-CB7DGV00.js";import"./constant-I5scnKCP.js";import"./point-DWREGWZc.js";import"./index-BNR9-8HJ.js";import"./touch-Dr12ZUMz.js";import"./index-BvYcEE5T.js";const v="%||%";function Yt(s,t,a,h,D){let g=new Map,C=new Set,S=new Set,x=[...h.dimensions],b=h.extraSettings[11]==="0"?0:1,Q=[],E=[],m=[];for(let o=0;o<D.length;o++)D[o].dataType=="string"?E.push(D[o]):m.push(D[o]);for(let o=0;o<t.length;o++)new Array(t.length).fill(0);for(let o of s)for(let p=1;p<t.length;p++){let d=p-1,i=p,k=t[d],w=t[i];if(b&&je(o[k])&&je(o[w]))continue;let P=h.dimensions[d],A=h.dimensions[i],H=o[k].formattedValue,O=o[w].formattedValue,y="",N="";if(H==="Null"){y=P+v+H+v+d;for(let c=d;c>=0;c--){let M=t[c];if(k=t[c],d=c,o[M].formattedValue!=="Null"){H=o[M].formattedValue,P=h.dimensions[c],d=c;break}}}else if(O==="Null"){N=A+v+O+v+i;for(let c=i;c<t.length;c++){let M=t[c];if(i=c,o[M].formattedValue!=="Null"){O=o[M].formattedValue,A=h.dimensions[c],i=c,p=c;break}}}let T=P+v+H+v+d,V=A+v+O+v+i;if(!b&&(y!==""||N!=="")){if(N!==""&&y==""){let c=T+N;g.has(c)?r=_(o,a):g.set(c,{source:T,target:N,value:0}),C.add(N)}else if(y!==""&&N==""){let c=y+V;g.has(c)?r=_(o,a):g.set(c,{source:y,target:V,value:0}),C.add(y)}}let r=_(o,a);if(r<0&&(Q.push({sourceDimName:P,value:r}),r=r*-1),Number.isNaN(r))throw new Error("The selected measure contains non-numeric values.");let I={},X=T+V;if(g.has(X)){r+=g.get(X).value;for(let c=0;c<m.length;c++){const M=m[c].fieldName,re=m[c].index;let z=parseFloat(o[re].value);z=z<0?z*-1:z,g.get(X)[M]?I[M]=z+g.get(X)[M]:I[M]=z}}else for(let c=0;c<m.length;c++){const M=m[c].fieldName,re=m[c].index;let z=parseFloat(o[re].value);z=z<0?z*-1:z,I[M]=z}C.add(T).add(V);let ie={source:T,target:V,value:r};for(const[c,M]of Object.entries(I))ie[c]=M;g.set(X,ie)}if(b)for(let o of s){if(t.length===1){let p=h.dimensions[0],d="target dim",i=o[t[0]].formattedValue,k=o[t[0]].formattedValue,w=p+v+i+v+1,P=d+v+k+v+1;C.add(w).add(P),g.set(w,{source:w,target:P,value:10})}for(let p=1;p<t.length;p++){let d=p-1,i=p,k=t[d],w=t[i],P=h.dimensions[d],A=h.dimensions[i],H=o[k].formattedValue,O=o[w].formattedValue,y="",N="";if(H==="Null"){y=P+v+H+v+d;for(let r=d;r>=0;r--){let I=t[r];if(k=t[r],d=r,o[I].formattedValue!=="Null"){H=o[I].formattedValue,P=h.dimensions[r],d=r;break}}}else if(O==="Null"){N=A+v+O+v+i;for(let r=i;r<t.length;r++){let I=t[r];if(i=r,o[I].formattedValue!=="Null"){O=o[I].formattedValue,A=h.dimensions[r],i=r;break}}}let T=P+v+H+v+d,V=A+v+O+v+i;if(y!==""||N!==""){if(N!==""&&y==""){let r=T+N;g.has(r)?_(o,a):g.set(r,{source:T,target:N,value:0}),C.add(N)}else if(y!==""&&N==""){let r=y+V;g.has(r)?_(o,a):g.set(r,{source:y,target:V,value:0}),C.add(y)}}if(y===""&&N===""){let r=T+V;g.has(r)?_(o,a):g.set(r,{source:T,target:V,value:0}),C.add(T).add(V)}}}if(!b)for(let o of s){let p=0;for(p=1;p<t.length;p++){let d=p-1,i=p,k=t[d],w=t[i],P=h.dimensions[d],A=h.dimensions[i],H=o[k].formattedValue,O=o[w].formattedValue,y="",N="";if(H==="Null"){y=P+v+H+v+d;for(let r=d;r>=0;r--){let I=t[r];if(k=t[r],d=r,o[I].formattedValue!=="Null"){H=o[I].formattedValue,P=h.dimensions[r],d=r;break}}}else if(O==="Null"){N=A+v+O+v+i;for(let r=i;r<t.length;r++){let I=t[r];if(i=r,o[I].formattedValue!=="Null"){O=o[I].formattedValue,A=h.dimensions[r],i=r;break}}}let T=P+v+H+v+d,V=A+v+O+v+i;if(y!==""||N!==""){if(N!==""&&y==""){let r=T+N;g.has(r)?_(o,a):g.set(r,{source:T,target:N,value:0}),C.add(N)}else if(y!==""&&N==""){let r=y+V;g.has(r)?_(o,a):g.set(r,{source:y,target:V,value:0}),C.add(y)}}}}let j=Array.from(C,o=>{let[p,d,i]=o.split(v);return S.add(p),{dimension:p,name:d,id:o,layah:parseInt(i),maxLayers:t.length,percentageOfTotal:0,percentageOfGroup:0}});j.forEach(o=>{for(let p=0;p<m.length;p++){const d=m[p].fieldName,i=m[p].index;s.forEach(k=>{let w=parseFloat(k[i].value);k.forEach(P=>{P._value===o.name&&(o[d]?o[d]+=w:o[d]=w),h.measure})})}});function F(o,p){return o.layer<p.layer?-1:o.layer>p.layer?1:0}j.sort(F);let q=Array.from(g.values());return S=Array.from(S),x.forEach((o,p)=>{S.find(d=>String(d)===String(o))||x.splice(p,1)}),{nodes:j,links:q,header:x,negativeMarks:Q,columns:m}}let ye=null;function Xt(s,t,a){let{measureName:h,measure:D,measureFormat:g,measureStyle:C,color:S,width:x,height:b,mixBlendMode:Q,fontSize:E,extraSettings:m,isDarkTheme:j,dimensionColors:F,memberColors:q,valueColors:o,useNewColorFormat:p,enableLegend:d,legendPosition:i,legendRows:k,legendColumns:w,legendPaddingX:P,legendPaddingY:A,legendType:H,scaleLegendItems:O,scaleLegendColor:y,scaleLegendOrder:N,slotAliases:T}=a;const V=new xt("#tooltip",x,b);if(h||(h=D?D.fieldName:"No measure"),t.header)for(let e=0;e<t.header.length;e++)T.hasOwnProperty(t.header[e])&&T[t.header[e]]!==""?t.header[e]=T[t.header[e]]:t.header[e]=t.header[e];let r=m[0]||"dimension",I=m[1]||"both",X=parseInt(m[2])||100,ie=parseInt(m[3])||10,c=parseInt(m[4])||2,M=(parseFloat(m[5])||50)/100,re=(parseFloat(m[6])||100)/100,z=m[7]||"sankeyLeft",We=m[8]==="1"?1:0,_e=m[9]==="0"?0:1,Ne=m[14]==="1"?1:0,U=m[10]||"inside",ae=a.extraSettings[11]==="0"?0:1,ue=m[12]||"auto",Me=m[13]||"auto",Fe=parseInt(m[15])||30,qe=parseInt(m[17])+1||16,Je=parseInt(m[16])+1||45,ze=m[18]==="1"?1:0,ke=m[19]||0,be=m[20]||0,Ke=m[21]||(a!=null&&a.textColor?a.textColor:"#ffffff"),De=m[22]||(a!=null&&a.textColorLinks?a.textColorLinks:"#ffffff"),Ze=m[23]||(a!=null&&a.textColorHeader?a.textColorHeader:"#000000"),Qe=m[24]||"#333333",Ee=m[25]||"#dddddd",Ae=new Intl.Collator(void 0,{usage:"sort"}).compare;g||(g=".1f");let K=Pe(g||"");C?K=Ge(C):(C={displayUnits:"none",maximumFractionDigits:0,prefix:"",style:"decimal",suffix:"",unit:"",useGrouping:!0},K=Ge(C));let ee=Pe(g);C&&(ee=kt(C));let G=Pe(".1%"),se=5,fe=Ne?i!=="top"?40:20:0,ce=se,Re=x-se,de=se,we=b-se,Y=t.nodes.length*Fe*x/b,R=t.nodes.length*Fe;Y=Y<x?x:Y,R=R<b?b:R,Y=Y<t.nodes.length*10*x/b?t.nodes.length*10*x/b:Y,R=R<t.nodes.length*10?t.nodes.length*10:R,de+=fe,d&&(i==="left"&&(ce+=w*100+35),i==="right"&&(Re-=w*100+45),i==="top"&&(de+=k*18+40),i==="bottom"&&(we-=k*18+60)),r==="unique"&&(i==="top"&&(de+=(k-1)*16),i==="bottom"&&(we-=(k-1)*16));let et=i==="left"?ce:0,tt=d&&i==="top"?de-fe-3:0,te=i==="left"?ce:i==="right"?w*100+45:0;Ne&&new yt(s,t.header,X,a.width-te,b,E,Ze,et,tt,d?te=d&&i==="left"?te:d&&i==="right"?te-140:te:te).title("Header").draw();let lt=i==="left"?Y/x*ce:0,me=i==="right"?Y/x*(w*100+45):0;me=U==="outside"?me+100:me;let rt=i==="top"?R/b*(k*18+30+fe):R/b*fe,at=i==="bottom"?R/b*(k*18+60):0,ot=mt().nodeAlign(ht[z]).nodeWidth(X).nodePadding(ie).linkSort(function(e,l){if(e.source.name==="Null")return!0;if(Me==="valueHighToLow")return l.value-e.value;if(Me==="valueLowToHigh")return e.value-l.value}).nodeSort(function(e,l){if(e.name==="Null")return!0;if(ue==="asc")return Ae(e.name,l.name);if(ue==="desc")return Ae(l.name,e.name);if(ue==="valueHighToLow")return l.value-e.value;if(ue==="valueLowToHigh")return e.value-l.value}).nodeId(e=>e.id).extent([[-Y/2+lt,-R/2+rt],[Y/2-me,R/2-at]]);s.on("click",Oe);let nt=s.append("g").attr("class","links").attr("fill","none").attr("stroke-opacity",M),it=s.append("g").attr("class","nodes").attr("font-size",E+"rem"),ut=$(".nodes,.links");var Be=gt.translate(x/2,b/2).scale(b/R);function st(){let{x:e,y:l,k:f}=He.transform;ut.attr("transform",`translate(${e},${l}) scale(${f})`)}var Te=vt().on("zoom",st);s.call(Te).call(Te.transform,Be),s.on("dblclick.zoom",null);function ft(){Te.transform(s,Be)}try{ot(t)}catch(e){console.log("Error message from sankey layout ",e)}if(t.header.length===1){t.links=[];let e=new Set;t.nodes=t.nodes.filter(l=>e.has(l.name)?!1:(e.add(l.name),!0))}Nt()?t.nodes.forEach(e=>{e.value=D?e[a==null?void 0:a.measure._fieldName]:"No measure"}):t.nodes.forEach(e=>{e.value=e[a.measure]});let Ve=0,oe={};t.nodes.forEach(e=>{e.layer==0&&(Ve+=e.value);const l=e.dimension;oe[l]?oe[l]+=e.value:oe[l]=e.value}),t.nodes.forEach(e=>{e.layer=e.layah});let Le=it.selectAll(".node").data(t.nodes).enter().append("g").attr("class","node");Le.append("rect").attr("class","node-rect").attr("x",e=>e.x0+c*2).attr("y",e=>e.y0).attr("width",e=>{let l=e.x0+c*2;return e.x1-l-c*2}).attr("fill",e=>{let l=null;if(p){if(r==="unique"||r==="tag"){l=null;for(var f=e.dimension+" - "+e.name,n=0;n<o.length;n++)o[n].fieldName==f&&(l=o[n].color)}else if(r==="value"){l=null;for(var u=0;u<q.length;u++)q[u].fieldName==e.name&&(l=q[u].color)}else{l=null;for(var u=0;u<F.length;u++)F[u].fieldName===e.dimension&&(l=F[u].color)}return l||S(r==="unique"?e.id:r==="value"?e.name:e.dimension)}else return l=S(r==="unique"?e.id:r==="value"?e.name:e.dimension)}).classed("focus",e=>e.dimension===ye).on("click",Vt).on("mouseover",e=>{let l={DimensionName:e.dimension,DimensionValue:e.name.bold(),PercentageOfTotal:G(e.value/Ve).bold(),PercentageOfGroup:G(e.value/oe[e.dimension]).bold(),MeasureName:h,MeasureValue:K(e.value).bold()};t.columns.forEach(f=>{l[f.fieldName]=ee(e[f.fieldName])}),V.show(a.tooltips.node.content||a.tooltips.node,l),ze===0&&J(e)}).on("mousemove",()=>{V.updatePosition()}).on("mouseout",()=>{V.hide(),Z()}),Le.selectAll("rect").filter(e=>ae?e.name!=="Null":!0).attr("stroke-width",e=>We?1:0).attr("stroke",Qe).attr("fill-opacity",re).attr("height",e=>e.y1-e.y0);let ne=nt.selectAll(".link").data(t.links).enter().append("g").attr("class","link").style("mix-blend-mode",Q);if(I==="both"){let e=ne.append("linearGradient").attr("id",l=>`link-${l.index}`).attr("gradientUnits","userSpaceOnUse").attr("x1",l=>l.source.x1).attr("x2",l=>l.target.x0);e.append("stop").attr("offset","0%").attr("stop-color",l=>{if(r==="unique"||r==="tag"){var f=null;let u=l.source.dimension+" - "+l.source.name;for(var n=0;n<o.length;n++)o[n].fieldName===u&&(f=o[n].color);return f}else if(r==="value"){for(var f=null,n=0;n<q.length;n++)q[n].fieldName===l.source.name&&(f=q[n].color);return f}else{for(var f=null,n=0;n<F.length;n++)F[n].fieldName===l.source.dimension&&(f=F[n].color);return f||S(r==="unique"?l.source.id:r==="value"?l.source.name:l.source.dimension)}}),e.append("stop").attr("offset","100%").attr("stop-color",l=>{if(r==="unique"){var f=null;let u=l.target.dimension+" - "+l.target.name;for(var n=0;n<o.length;n++)o[n].fieldName===u&&(f=o[n].color);return f}else if(r==="value"){for(var f=null,n=0;n<q.length;n++)q[n].fieldName===l.target.name&&(f=q[n].color);return f}else{for(var f=null,n=0;n<F.length;n++)F[n].fieldName===l.target.dimension&&(f=F[n].color);return f||S(r==="unique"?l.target.id:r==="value"?l.target.name:l.target.dimension)}})}if(ne.append("path").attr("class","link").on("click",Lt).attr("stroke-width",1).on("mouseover",e=>{let l={MeasureName:h,MeasureValue:K(e.value).bold(),PercentOfSource:G(e.value/e.source.value).bold(),SourceName:e.source.name.bold(),PercentOfTarget:G(e.value/e.target.value).bold(),TargetName:e.target.name.bold()};t.columns.forEach(f=>{l[f.fieldName]=ee(e[f.fieldName])}),V.show(a.tooltips.link.content||a.tooltips.link,l),ze===0&&J(e)}).on("mousemove",()=>{V.updatePosition()}).on("mouseout",()=>{V.hide(),Z()}),a.labels.fromLink.enabled&&ne.append("foreignObject").attr("width",300).attr("height",300).filter(e=>e.width>qe?ae?e.source.name!=="Null"&&e.target.name!=="Null":!0:!1).attr("x",function(e){return e.source.x1+2}).attr("y",function(e){return e.y0-8*E}).style("pointer-events","none").attr("color",De).html(function(e){let l={MeasureName:h,MeasureValue:K(e.value),PercentOfSource:G(e.value/e.source.value),SourceName:e.source.name,PercentOfTarget:G(e.value/e.target.value),TargetName:e.target.name};return t.columns.forEach(f=>{l[f.fieldName]=ee(e[f.fieldName])}),Ie(a.labels.fromLink.content,l)}),ne.select("path").attr("d",pt()).filter(e=>ae?e.source.name!=="Null"&&e.target.name!=="Null":!0).attr("stroke",e=>{if(p){let n=r==="unique"?e.source.dimension+" - "+e.source.name:r==="value"?e.source.name:e.source.dimension,u=r==="unique"?e.target.dimension+" - "+e.target.name:r==="value"?e.target.name:e.target.dimension,L=r==="unique"?o:r==="value"?q:F;switch(I){case"none":return Ee;case"both":return`url(#link-${e.index})`;case"input":for(var f=null,l=0;l<L.length;l++)L[l].fieldName===n&&(f=L[l].color);return f;default:for(var f=S(r==="unique"?e.source.id:r==="value"?e.source.name:e.source.dimension),l=0;l<L.length;l++)L[l].fieldName===u&&(f=L[l].color);return f}}else switch(I){case"none":return Ee;case"both":return`url(#link-${e.index})`;case"input":return S(r==="unique"?e.source.id:r==="value"?e.source.name:e.source.dimension);default:return S(r==="unique"?e.target.id:r==="value"?e.target.name:e.target.dimension)}}).attr("stroke-width",e=>e.width),a.labels.toLink.enabled&&ne.append("foreignObject").attr("width",300).attr("height",300).filter(e=>e.width>qe?ae?e.target.name!=="Null":!0:!1).attr("x",function(e){return e.target.x0-300-2}).attr("y",function(e){return e.y1-8*E}).style("pointer-events","none").attr("color",De).html(function(e){let l={MeasureName:h,MeasureValue:K(e.value),PercentOfSource:G(e.value/e.source.value),SourceName:e.source.name,PercentOfTarget:G(e.value/e.target.value),TargetName:e.target.name};return t.columns.forEach(n=>{l[n.fieldName]=ee(e[n.fieldName])}),'<div style="text-align: right">'+Ie(a.labels.toLink.content,l)+"</div>"}),(_e&&a.labels.node.enabled||a.labels.node.enabled)&&(Le.append("foreignObject").attr("width",e=>{let l=e.x0+c*2;return e.x1-l-c*2}).attr("height",e=>e.y1-e.y0).filter(e=>e.y1-e.y0>Je?ae?e.name!=="Null":!0:!1).attr("x",e=>U==="outside"?e.x0-c-100:e.x0+c).attr("y",e=>e.y0).attr("dy","0.35em").attr("text-anchor",U==="outside"?"end":"start").style("pointer-events","none").attr("color",Ke).html(function(e){let l={DimensionName:e.dimension,DimensionValue:e.name,MeasureName:h,MeasureValue:K(e.value),PercentageOfGroup:G(e.value/Ve),PercentageOfTotal:G(e.value/oe[e.dimension])};t.columns.forEach(u=>{l[u.fieldName]=ee(e[u.fieldName])});let f=Ie(a.labels.node.content,l),n=()=>{let u="width :100%;";return ke==="0"?u+="text-align:left;":ke==="1"?u+="text-align:center;":ke==="2"&&(u+="text-align:right;"),be==="0"&&(u+="top:0;transform:translateY(0);"),be==="1"&&(u+="top:50%;transform:translateY(-50%);"),be==="2"&&(u+="top:100%;transform:translateY(-100%);"),u+="padding-left:5px;padding-right:5px;padding-top:8px;padding-bottom:8px;position:absolute;",u};return U==="outside"?`<div style="${n()}" line-height:1;>${f}</div>`:`<div style="${n()}line-height:1;">${f}</div>`}).filter(e=>U==="outside"?e.x0<x/2:e.x0+2).attr("x",e=>U==="outside"?e.x1+6:e.x1-X+c*2+0).attr("text-anchor","start"),U==="inside"&&$("text").call(Ct,l=>{let f=l.x0+c*2;return l.x1-f-c*2})),d){let e=d&&i==="right"?Re+20:10,l=d&&i==="bottom"?we+10:20;e+=parseInt(P),l+=parseInt(A),l+=Ne?20:0;const f=()=>{let n=[];for(let u=0;u<t.nodes.length;u++)n.some(L=>L.name===t.nodes[u].name)||n.push(t.nodes[u]);return n};H==="color"?r==="value"?new pe(s,f(),j).title(a.legendTitle?a.legendTitle:"Values").text(n=>n.name).offset(e,l).positioning(i).nrRows(k).nrColumns(w).legendType("color").color(n=>{if(p){for(var u=0;u<q.length;u++)if(q[u].fieldName===n)return q[u].color}else return S(n)}).highlight(J).clearHighlight(Z).draw():r==="unique"?new pe(s,f(),j).title(a.legendTitle?a.legendTitle:"Values").text(n=>n.name).formattedText(n=>n.name).offset(e,l).positioning(i).nrRows(k).nrColumns(w).legendType("color").color(n=>{if(p){for(var u=0;u<o.length;u++)if(o[u].fieldName.split(" - ").pop()===n)return o[u].color}else return S(n)}).highlight(J).clearHighlight(Z).draw():r==="dimension"&&new pe(s,t.header,j).title(a.legendTitle?a.legendTitle:"Dimensions").text(n=>n).offset(e,l).positioning(i).nrRows(k).nrColumns(w).legendType("color").color(n=>{const u=()=>{if(T){let B=Object.keys(T).find(W=>T[W]===n);return B!==void 0&&B!==""?B:n}};if(p){for(var L=0;L<F.length;L++)if(F[L].fieldName===u())return F[L].color}else return S(u())}).highlight(J).clearHighlight(Z).draw():H==="scale"&&(async()=>{for(;!t.links[0].width;)await new Promise(he=>setTimeout(he,100));let n=t.links[0].value/t.links[0].width;for(var u=9999999,L=0,B=0;B<t.links.length;B++)t.links[B].value<u&&(u=t.links[B].value),t.links[B].value>L&&(L=t.links[B].value);var W=[];let ct=L-u,Ce=O,dt=ct/(Ce-1);for(var le=0;le<Ce;le++)W[le]=le===0?ge(u):le===Ce-1?ge(L):ge(u+dt*le);O==="1"&&(W[0]=ge(L)),N==="high-low"&&W.reverse(),new pe(s,W,j).title(a.legendTitle?a.legendTitle:"Scale legend").text(he=>he.name).offset(e,l).positioning(i).nrRows(k).nrColumns(w).legendType("scale").setPixelValue(n).color(he=>y).highlight(J).clearHighlight(Z).draw()})()}function $e(e,l,f,n){s.append("g").attr("class","reset").append("circle").attr("fill","#ffffff").attr("cx",e).attr("cy",l).attr("r",15).attr("stroke","#ddd").attr("fill","#69a3b2").attr("pointer-events","all").attr("fill","#ddd").attr("width",110).attr("height",20).attr("opacity",1).on("click",function(){ft(),xe(this).attr("opacity",0),$(".buttonText").remove()}),s.append("g").attr("class","buttonText").append("foreignObject").attr("class","buttonText").attr("x",f).attr("y",n).attr("width",100).attr("height",20).style("font-color","#ddd").attr("font-weight","bold").attr("pointer-events","none").attr("dy","0.35em").append("xhtml:div").style("font","14px 'Helvetica Neue'").html('<span ><svg style="width:24px;height:24px" viewBox="0 0 24 26"><path fill="currentColor" d="M12 5.5L10 8H14L12 5.5M18 10V14L20.5 12L18 10M6 10L3.5 12L6 14V10M14 16H10L12 18.5L14 16M21 3H3C1.9 3 1 3.9 1 5V19C1 20.1 1.9 21 3 21H21C22.1 21 23 20.1 23 19V5C23 3.9 22.1 3 21 3M21 19H3V5H21V19Z" /></svg> <span> ').attr("pointer-events","none"),B();function B(){setTimeout(W,3e3)}function W(){$(".reset").remove(),$(".buttonText").remove()}}s.append("g").attr("class","buttons").append("rect").attr("class","buttons").attr("x",x-100).attr("y",5).attr("width",110).attr("height",20).attr("pointer-events","all").attr("opacity",0).on("mouseover",()=>{$e(x-20,20,x-32,9)}),s.append("g").attr("class","buttons").append("rect").attr("class","buttons").attr("x",10).attr("y",5).attr("width",110).attr("height",20).attr("pointer-events","all").attr("opacity",0).on("mouseover",()=>{$e(20,20,8,9)})}const Vt=async function(t){He.stopPropagation();let a=xe(this),h=a.classed("focus");await Oe(),!h&&(ye=t.dimension,a.classed("focus",!0),J(t,{fixHighlight:!0}),bt(t.dimension,t.name))},Lt=async function(t){He.stopPropagation();let h=xe(this).classed("focus");await Oe(),!h&&(ye=t.dimension,J(t,{fixHighlight:!0}),wt({link:t,source:t.source,target:t.target}))};function Oe(){return ye=null,$(".focus").classed("focus",!1),$(".focusLink").classed("focusLink",!1),Z({unfixHighlight:!0}),Tt()}let ve;function J(s,{fixHighlight:t=!1}={}){ve||Se||($(".node").style("opacity",a=>Ye(s,a)?1:.3),$(".link").style("opacity",a=>Ye(s,a)?1:.3),t&&(ve=!0))}let Se;function Z({unfixHighlight:s=!1}={}){s&&(ve=!1,Se=!1),!(ve||Se)&&($(".node").style("opacity",1),$(".link").style("opacity",1))}function Ye(s,t){return!!(t===s||s.source===t||s.target===t||Xe(s,t)||Ue(s,t))}function Xe(s,t){s=s.source?s.source:s;let a;return t&&(a=t.target?[t.target]:t.sourceLinks.map(h=>h.target)),a?a.includes(s)?!0:a.some(h=>Xe(s,h)):!1}function Ue(s,t){s=s.target?s.target:s;let a;return t&&(a=t.source?[t.source]:t.targetLinks.map(h=>h.source)),a?a.includes(s)?!0:a.some(h=>Ue(s,h)):!1}function Ct(s,t){s.each(function(){let a=xe(this),h=a.text().split(/\s+/).reverse(),D,g=[],C=a.attr("y"),S=parseFloat(a.attr("dy")),x=a.text(null).append("tspan").attr("y",C).attr("dx",0),b=[x];setTimeout(()=>{for(;D=h.pop();)if(g.push(D),x.text(g.join(" ")),x.node().getComputedTextLength()>t){g.pop(),x.text(g.join(" ")),g=[D];let E=x.node().getComputedTextLength();x=a.append("tspan").attr("y",C).attr("dx",E*-1).text(D),b.push(x)}if(b.length<=1)return;let Q=-(b.length-1)/2;for(let E=0;E<b.length;E++){let m=b[E],j=Q+E+S;m.attr("dy",j+"em")}},0)})}export{Xt as draw,Yt as parse};
//# sourceMappingURL=sankey-diagram-BRgB7qiR.js.map
