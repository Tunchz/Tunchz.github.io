<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Covid-19 Stat - สถิติผู้ติดเชื้อโควิด-19</title>
    <meta name="description" content="Interactive dashboard สำหรับการศึกษาข้อมูลผู้ติดเชื้อโควิด-19 (Covid-19) ในประเทศไทย">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="css\epistat.min.blue.css">
    <link rel="stylesheet" href="css\Raleway400f.css">
    <link rel="icon" type="image/x-icon" href="img\icons\Mholan_Logo.png"/>
    <style>
        body {
            font-family: Raleway
        }
    </style>
    <link rel="stylesheet" href="css\epistat.tunchz.blue.css">
    
</head>

<body>
    <div class="container-fluid">
        <div class="row height100p" id="wholecontent" class="charts">
            <div class="col-sm-3 height100p" id="zone1">
                <br>
                <div id="prov-chart" class="">ผู้ป่วยติดเชื้อแยกตาม<strong>จังหวัด </strong><a class="reset" href="javascript:provChart.filterAll();dc.redrawAll();" style="display: none;">reset</a></div>
            </div>
            <div class="col-sm-9 height100p">
                <div class="row height10p">
                    <div class="col-sm-5 height100p" id="zone21">
                        <div class="row">
                            <div class="col-xs-10">
                                <h1 class="h3"><img id="logo" src="img\icons\Mholan_Logo.png" style="float:left" width=30 height=30></img>MHOLAN <small>Covid-19 Stat   :</small> <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#info-modal"><strong>รายละเอียด</strong></button></h1>
                                <div class="modal fade" id="info-modal" tabindex="-1" role="dialog" aria-labelledby="info-modalLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                                <h2 class="modal-title h3" id="myModalLabel"><a href="home\index.htm">MHOLAN</a> &gt; Covid-19 Statistics Dashboard</h2>
                                            </div>
                                            <div class="modal-body">
                                                <h3 style="margin-top:0">How to use</h3>
                                                <p>To use this tool you have to click on each chart to filter through cases.</p>
                                                <h4 class="">5 Graphs:</h4>
                                                <ol>
                                                    <li>the pathogen in row chart,</li>
                                                    <li>the week in line chart,</li>
                                                    <li>the place of residence in map (the square in bottom-left is 'ไม่ระบุ'),</li>
                                                    <li>the age in bar chart,</li>
                                                    <li>the gender in row chart.</li>
                                                </ol>
                                                <p>All the numbers you can see on the graphs are raw number of cases. Except the map represents the incidence per 100k inhabitants &mdash; <i>i.e.</i> count x 1e5 / population_of_2012.</p>
                                                <h3>Data</h3>
                                                <p>Provided by the sentinel laboratory network (Epilabo), the National Reference Centers (NRC) or the HIV/AIDS register. <a data-toggle="modal" data-target="#datasource-modal" href="">See detailed data sources per pathogen</a></p>
                                                <ul>
                                                    <li>The date is agregated to the monday of the week.</li>
                                                    <li>The location is agregated to the province.</li>
                                                </ul>
                                                <p>Mholan is not responsible for the conclusions drawn on the basis of these data.</p>
                                                <h3>Contact</h3>
                                                <p>For questions, feedback, technical problems or errors; contact <a href="mailto:tunchz@gmail.com">tunchz@gmail.com</a>.</p>
                                                <p></p>
                                            </div>
                                            <div class="modal-footer"><span class="pull-left">Made by Mholan Bigdata Team</span><br><span class="pull-left">Copyright &#169; Mholan Co,lmd., All Rights Reserved.</span> <button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal fade" id="datasource-modal" tabindex="-1" role="dialog" aria-labelledby="datasource-modalLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                                <h3 class="modal-title" id="myModalLabel">Data Source</h3>
                                            </div>
                                            <div class="modal-body">
                                                <table class="table table-condensed">
                                                    <thead>
                                                        <tr>
                                                            <th>ชุดข้อมูล</th>
                                                            <th>แหล่งข้อมูล</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td>Covid-19-Daily</td>
                                                            <td>https://data.go.th/dataset/covid-19-daily</td>
                                                        </tr>
                                                        <tr>
                                                            <td>ข้อมูล....</td>
                                                            <td>แหล่ง....</td>
                                                        </tr>

                                                    </tbody>
                                                </table>
                                            </div>
                                            <div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-7 height100p" id="zone22">
                        <div id="dc-data-count">
                            <div class="row">
                                <div class="col-xs-10">
                                    <div class="h3"><strong class="filter-count">-</strong> <span class="text-sm"> รายถูกเลือก จากทั้งหมด <strong class="total-count">-</strong> ราย</span></div>
                                    <div class="h5"><span id="viewFilters"></span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row height60p">
                    <div class="col-sm-6 height100p" id="zone3">
                        <br>
                        <div id="map-chart"><strong>Map </strong><a class="reset" href="javascript:mapChart.filterAll();dc.redrawAll();" style="display: none;">reset</a></div>
                    </div>
                    <div class="col-sm-6 height100p" id="zone4-5">
                        <div class="row height50p">
                            <div class="col-md-12 height100p" id="zone5">
                                <br>
                                <div id="gender-chart" class="">ผู้ป่วยติดเชื้อแยกตาม<strong>เพศ </strong><a class="reset" href="javascript:genderChart.filterAll();dc.redrawAll();" style="display: none;">reset</a></div>
                            </div>
                        </div>
                        <div class="row height50p">
                            <br>
                            <div class="col-md-12 height100p" id="zone4">
                                <div id="age-chart" class="">ผู้ป่วยติดเชื้อแยกตาม<strong>อายุ </strong><a class="reset" href="javascript:ageChart.filterAll();dc.redrawAll();" style="display: none;">reset</a></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row height30p">
                    <div class="col-md-12 height100p" id="zone2">
                        <div id="date-chart" class=""><strong>ผู้ป่วยสะสม </strong><a class="reset" href="javascript:dateChart.filterAll();dc.redrawAll();" style="display: none;">reset</a></div>
                    </div>
                </div>

            </div>
        </div>
    </div>





    <script src="js\epistat.min.js"></script>
    <!script src="js\d3.v3.min.js"><!/script>

    <script>
        var goldenRatio = 1.618034,
            transitionDuration = 200,
            minHeight = 500,
            svgPadding = 30,
            Theme_Color = "#0ab4f3",//"#FF6900";
            //Theme_Color_Range = d3.scaleLinear().domain([1,150]).range(["white", "blue"]);
            //Theme_Color_Range = d3.scaleSequential().domain([1,150]).interpolator(d3.interpolateViridis);
            Theme_Color_Range = [/*"#f8fbff", "#deecf8",*/ "#c6dbef", "#9ecae1", "#6baed6", "#4292c6", "#2171b5", "#07519c", "#253494", "#071d58", "#800026", "#800026", "#800026"];
            //["#FFE1CC", "#FFD5B7", "#FFC9A3", "#FFBD8E", "#FFB17A", "#FFA566", "#FF9951", "#FF8D3D", "#FF8128", "#FF7514", "#FF6900"];

        function getURLParameter(e) {
            return decodeURIComponent((new RegExp("[?|&]" + e + "=([^&;]+?)(&|#|;|$)").exec(location.search) || [, ""])[1].replace(/\+/g, "%20")) || null
        }
        var filterGerm, csvfile, 
            provChart = dc.rowChart("#prov-chart"),
            dateChart = dc.lineChart("#date-chart"),
            mapChart = dc.geoChoroplethChart("#map-chart"),
            ageChart = dc.barChart("#age-chart"),
            genderChart = dc.rowChart("#gender-chart");
            //genderChart = dc.rowChart("#gender-chart");
//            filterGerm = getURLParameter("germ") ? getURLParameter("germ") : "Respiratory Syncytial Virus", csvfile = getURLParameter("sample") && 0 != getURLParameter("sample") ? "https://Tunchz.github.io/public_cases_sample.csv" : getURLParameter("demo") && 0 != getURLParameter("demo") ? "https://Tunchz.github.io/public_cases_sample.csv" : "https://Tunchz.github.io/public_cases.csv", d3.csv(csvfile, function(e, y) {
            filterGerm = getURLParameter("germ") ? getURLParameter("germ") : "Respiratory Syncytial Virus", csvfile = getURLParameter("sample") && 0 != getURLParameter("sample") ? "covid-19-daily.csv" : getURLParameter("demo") && 0 != getURLParameter("demo") ? "https://Tunchz.github.io/covid-19-daily.csv" : "https://Tunchz.github.io/covid-19-daily.csv", d3.csv(csvfile, function(csv, y) {
                
                d3.json("https://Tunchz.github.io/mapth_small_+unknown.json", function(json) {
                    var t = d3.time.format("%m/%d/%Y");
                    //console.log(json);
                    d3.format(".2f");
                    //console.log(y);
                    y.forEach(function(e, a) {
                        e.date = t.parse(e["Announce Date"])
                        delete e["Announce Date"]
                        e.Province === "กทม" ? e.Province = "กรุงเทพมหานคร" : e.Province === "" ? e.Province = "ไม่ระบุ" : e.Province = e.Province.trim()
                        e.Province === "ไม่ระบุ" ? e.Province_filtered = "" : e.Province_filtered = e.Province
                        //e.Province_filtered = e.Province
                        e.sex === "" ? e.sex = "ไม่ระบุ" : e.sex = e.sex.trim()
                        e.incidence = 1
                    });
                    //console.log(y);
                    

                    //console.log(remove_unknown(a))
                    var r, a = crossfilter(y),
                        i = a.groupAll(),
                        u = a.dimension(function(e) {
                            return e.Province
                        }),
                        b = u.group().reduceSum(function(e) {
                            return e.incidence
                        }),
                        c = a.dimension(function(e) {
                            return e.Province_filtered
                        }),
                        s = c.group().reduceSum(function(e) {
                            return e.Province_filtered === "" ? 0 : 1
                        }),
                        //c_temp = c,
                        //c_unknown = c.filter(function(d){return d.Province = "ไม่ระบุ"}),
                        //c_unknown = c_temp.filter("กรุงเทพมหานคร"),
                        //s_unknown = c_unknown.group(),

                        n = a.dimension(function(e) {
                            return e.date
                        }),
                        o = n.group(),
                        d = a.dimension(function(e) {
                            return e.age
                        }),
                        l = d.group().reduceSum(function(e) {
                            return e.age === "" ? 0 : 1
                        }),
                        g = a.dimension(function(e) {
                            return e.sex
                        }),
                        S = g.group(),
                        m = document.getElementById("zone1").offsetWidth - svgPadding,
                        h = Math.max(document.getElementById("zone1").offsetHeight, minHeight) - svgPadding;

                    //console.log(c.group().top(2))
                    //console.log(c_unknown.group().top(2))


                    

                    provChart.width(m).height(h).margins({
                        top: 0,
                        left: 10,
                        right: 10,
                        bottom: 60
                    }).transitionDuration(transitionDuration).dimension(c).group(s).colors(Theme_Color).label(function(e) {
                        return e.key
                    })/*.filter(filterGerm)*/.ordering(function(e) { return -e.value; }).title(function(e) {
                        return e.key + " : " + e.value
                    }).elasticX(!0).xAxis()/*.orient("top")*/.ticks(3), window.onresize = function(e) {
                        var a = r.keyAccessor()(e);
                        dc.events.trigger(function() {
                            r.filter(null), r.filter(a), r.redrawGroup()
                        })
                        provChart.width(m).height(h).transitionDuration(0), dc.renderAll(), ageChart.transitionDuration(transitionDuration), dateChart.transitionDuration(transitionDuration),  ageChart.transitionDuration(transitionDuration), genderChart.transitionDuration(transitionDuration), mapChart.transitionDuration(transitionDuration)
                    };
/*                    .onpretransition = function() {
                        provChart.select('g.axis').attr('transform', 'translate(0,0)');
                        provChart.selectAll('line.grid-line').attr('y2', provChart.effectiveHeight());
                    };
*/


                    var p = d3.min(y, function(e) {
                            return e.date
                        }),
                        k = d3.max(y, function(e) {
                            return e.date
                        }),
                        j = document.getElementById("zone2").offsetWidth - svgPadding,
                        f = document.getElementById("zone2").offsetHeight - svgPadding;
                    dateChart.width(j).height(f).margins({
                        top: 30,
                        right: 30,
                        bottom: 40,
                        left: 20
                    }).dimension(n).group(o, "จำนวนผู้ป่วยสะสม").x(d3.time.scale().domain([p/*.setMonth(p.getMonth() - 1)*/, k/*.setMonth(k.getMonth() + 1)*/])).round(d3.time.day.round).renderArea(!0).transitionDuration(transitionDuration).elasticY(!0).renderHorizontalGridLines(!0).legend(dc.legend().x(50).y(10).itemHeight(13).gap(5)).brushOn(!0).mouseZoomable(!0).colors(Theme_Color)/*colors(Theme_Color).xAxisLabel("วัน/เดือน/ปี", 10)*/.yAxis().ticks(3);
 





                    var v = document.getElementById("zone3").offsetWidth// - svgPadding,
                        C = document.getElementById("zone3").offsetHeight;// - svgPadding;
                    mapChart.width(v).height(C).dimension(u).group(b).transitionDuration(200)
                            .projection(d3.geo.mercator().rotate([-100.6331, -13.2]).translate([v / 2, C / 2]).center([0, -0.8]).scale(3.55 * Math.min(v*2, C)))
                            .overlayGeoJson(json.features, "PROVINCE_N", function(e) {return e.properties.PROVINCE_N})
                            .colors(d3.scale.quantize().range(Theme_Color_Range))
                            .colorDomain([0, 50/*b.top(2)[0].key === "ไม่ระบุ" ? b.top(2)[1].value : b.top(2)[0].value*/])
                            .label(function(e) {return 15/*e.value*/})
                            .title(function(e) {return "จังหวัด : " + e.key + "\nจำนวนผู้ติดเชื้อ : " + e.value + " คน"})
                            .legend(dc.legend().x(50).y(10).itemHeight(13))
                            ;


//console.log(b.top(2)[0].value.toString())

                    

                    var E = document.getElementById("zone4").offsetWidth - svgPadding,
                        P = document.getElementById("zone4").offsetHeight - svgPadding;
                    ageChart.width(E).height(P).margins({
                        top: 10,
                        right: 30,
                        bottom: 20,
                        left: 20
                    }).dimension(d).group(l).transitionDuration(transitionDuration).elasticY(!0).centerBar(!1).gap(1).colors(Theme_Color).round(dc.round.floor).alwaysUseRounding(!0).x(d3.scale.linear().domain([0, 100])).renderHorizontalGridLines(!0)/*.xAxisLabel(["อายุ"])*/.yAxis().ticks(3);




                    var A = document.getElementById("zone5").offsetWidth - svgPadding,
                        R = document.getElementById("zone5").offsetHeight - svgPadding;
                    genderChart.width(A).height(R).margins({
                        top: 10,
                        left: 10,
                        right: 30,
                        bottom: 20
                    }).dimension(g).group(S).transitionDuration(transitionDuration).colors(Theme_Color).label(function(e) {
                        return e.key
                    }).title(function(e) {
                        return e.key + " : " + e.value + " ราย"
                    }).label(function(e) {
                        return e.key + " " + e.value + " ราย"
                    }).elasticX(!0).xAxis().ticks(3), window.onresize = function(e) {
                        var a = document.getElementById("zone1").offsetWidth - svgPadding,
                            t = Math.max(document.getElementById("zone1").offsetHeight, minHeight) - svgPadding;
                        provChart.width(a).height(t).transitionDuration(0);
                        var r = document.getElementById("zone2").offsetWidth - svgPadding,
                            i = document.getElementById("zone2").offsetHeight - svgPadding;
                        dateChart.width(r).height(i).transitionDuration(0);
                        var c = document.getElementById("zone4").offsetWidth - svgPadding,
                            s = document.getElementById("zone4").offsetHeight - svgPadding;
                        ageChart.width(c).height(s).transitionDuration(0);
                        var n = document.getElementById("zone5").offsetWidth - svgPadding,
                            o = document.getElementById("zone5").offsetHeight - svgPadding;
                        genderChart.width(n).height(o).transitionDuration(0), dc.renderAll(), provChart.transitionDuration(transitionDuration), dateChart.transitionDuration(transitionDuration), ageChart.transitionDuration(transitionDuration), genderChart.transitionDuration(transitionDuration)
                    }, 



                    dc.dataCount("#dc-data-count").dimension(a).group(i), dc.renderlet(function(e) {
                        dc.events.trigger(function() {
                            $("#viewFilters").html(""), 0 != provChart.filters().length && $("#viewFilters").append('<i class="fa fa-filter"></i> <span class="text-bg">จังหวัด</span>=<span class="text-md">' + provChart.filters() + "</span> "), 0 != dateChart.filters().length && $("#viewFilters").append('<i class="fa fa-filter"></i> <span class="text-bg">ช่วงวัน</span>=<span class="text-md">[' + t(dateChart.filters()[0][0]) + ", " + t(dateChart.filters()[0][1]) + "[</span> "), 0 != mapChart.filters().length && $("#viewFilters").append('<i class="fa fa-filter"></i> <span class="text-bg">จังหวัด</span>=<span class="text-md">' + mapChart.filters() + "</span> "), 0 != ageChart.filters().length && $("#viewFilters").append('<i class="fa fa-filter"></i> <span class="text-bg">อายุ</span>=<span class="text-md">' + ageChart.filters() + "</span> "), 0 != genderChart.filters().length && $("#viewFilters").append('<i class="fa fa-filter"></i> <span class="text-bg">เพศ</span>=<span class="text-md">' + genderChart.filters() + "</span> "), 0 == provChart.filters().length && 0 == dateChart.filters().length && 0 == mapChart.filters().length && 0 == ageChart.filters().length && 0 == genderChart.filters().length || $("#viewFilters").append('<a href="javascript:dc.filterAll();dc.redrawAll();"><strong>Reset All</strong></a>')
                        })
                    }), dc.renderAll()
                })
            });

    </script>
</body>

</html>