<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Covid-19 Stat - สถิติผู้ติดเชื้อโควิด-19</title>
    <meta name="description" content="Interactive dashboard สำหรับการศึกษาข้อมูลผู้ติดเชื้อโควิด-19 (Covid-19) ในประเทศไทย">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="css\covid19.min.blue.css">
    <!link rel="stylesheet" href="css\Raleway400f.css">
    <link rel="icon" type="image/x-icon" href="img\icons\Mholan_Logo.png"/>

    <link rel="stylesheet" href="css\covid19.tunchz.blue.css">
    
</head>

<body>
    <div class="container-fluid">
        <div class="col-md-12 height100p charts" id="wholecontent"  style="min-height: 700px">
            <div class="col-sm-3 height15p card-wrapper" id="zone-Tcol1">
                <div class="col-xs-12 height100p">
                    <div class="h2 row height30p" style="text-align: right; padding-top : 0px"><img id="logo" src="img\icons\Mholan_Logo.png" style="float:left" width=50 height=40></img><span style="font-family: DB Heavent;font-size: 36px;">Covid19 Stat </span><span><small>Dashboard </small></span>
                    </div>
                    <div style="text-align: right;"><button type="button" class="btn btn-primary" style="padding: 3px 9px;" data-toggle="modal" data-target="#info-modal"><strong>รายละเอียด</strong></button></div>
                    <div class="modal fade" id="info-modal" tabindex="-1" role="dialog" aria-labelledby="info-modalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h2 class="modal-title h3" id="myModalLabel"><a href="https://www.maholan.co.th/">MHOLAN</a> &gt; Covid-19 Statistics Dashboard </h2>
                                </div>
                                <div class="modal-body">
                                    <h3 style="margin-top:0">การใช้งาน</h3>
                                    <p>คลิ๊กเลือกในแต่ละกราฟเพื่อกรองข้อมูลที่แสดงบนแดชบอร์ด โดยจำนวนข้อมูลและตัวกรองจะถูกแสดงในมุมบนขวา และยกเลิกตัวกรองโดยการคลิ๊ก <a>reset</a> ในแต่ละกราฟ หรือ <a>Reset All</a> มุมซ้ายบนเพื่อยกเลิกตัวกรองทั้งหมด </p>
                                    <h3 class="">การแสดงผล 7 ส่วน:</h3>
                                    <ol>
                                        <li>ตัวเลขแสดงสถานะสถิติผู้ติดเชื้อ > ผู้ติดเชื้อ/กำลังรักษา/หายแล้ว/เสียชีวิต,</li>
                                        <li>การแท่งแนวนอนแสดงจำนวนผู้ติดเชื้อรายจังหวัดเรียงลำดับมากไปน้อย</li>
                                        <li>แผนที่แสดงจำนวนผู้ติดเชื้อในแต่ละจังหวัด (พื้นที่สี่เหลี่ยม - ไม่พบข้อมูล)</li>
                                        <li>กราฟวงกลมแสดงสัดส่วนเพศของผู้ติดเชื้อ</li>
                                        <li>กราฟแท่งแนวนอนแสดงจำนวนผู้ติดเชื้อแยกตามสัญชาติเรียงลำดับมากไปน้อย</li>
                                        <li>กราฟแท่งแนวตั้งแสดงจำนวนผู้ติดเชื้อตามอายุ (คลิ๊กแกน x เพื่อเปลี่ยน Brush/Tooltips mode)</li>
                                        <li>กราฟเส้นแสดงจำนวนผู้ติดเชื้อ/ผู้ติดเชื้อสะสมรายวัน (คลิ๊กแกน x เพื่อเปลี่ยน Brush/Tooltips mode)</li>
                                    </ol>
                                    <h3>ข้อมูล</h3>
                                    <p>ข้อมูลสถานการณ์โควิด 19 ของ กรมควบคุมโรค กระทรวงสาธารณสุข<a data-toggle="modal" data-target="#datasource-modal" href="">ดูรายละเอียดชุดข้อมูล</a></p>
                                    <ul>
                                        <li>Mholan จัดทำแดชบอร์ด Covid-19 Stat เพื่อใช้ศึกษาและติดตามสถานการณ์ของโรคระบาดโควิด 19 เพื่อประโยชน์กับสาธารณะชน ผู้จัดทำจะไม่รับผิดชอบการกระทำใดๆ ที่ก่อให้เกิดความเสียหายจากการนำข้อมูลไปใช้หรืออ้างอิง</li>
                                    </ul>
                                    <h3>ติดต่อ</h3>
                                    <p>สำหรับคำถามและข้อเสนอแนะติดต่อ <a href="mailto:tunchz@gmail.com">tunchz@gmail.com</a>.</p>
                                    <p></p>
                                </div>
                                <div class="modal-footer"><span class="pull-left">Made by Mholan Bigdata Team</span><br><span class="pull-left">Copyright &#169; Mholan Co,lmd., All Rights Reserved.</span> <button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div>
                            </div>
                        </div>
                    </div>
                    <div class="modal fade" id="datasource-modal" tabindex="-1" role="dialog" aria-labelledby="datasource-modalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h3 class="modal-title" id="myModalLabel">รายละเอียดแหล่งข้อมูล</h3>
                                </div>
                                <div class="modal-body">
                                    <table class="table table-condensed" style="font-size: 18px">
                                        <thead>
                                            <tr>
                                                <th>ชุดข้อมูล</th>
                                                <th>แหล่งข้อมูล</th>
                                            </tr>
                                        </thead>
                                        <tbody>

                                            <tr>
                                                <td>ข้อมูลแสดงค่าประจำวัน</td>
                                                <td>https://covid19.th-stat.com/api/open/today</td>
                                            </tr>
                                            <tr>
                                                <td>ข้อมูลแต่ละเคส</td>
                                                <td>https://covid19.th-stat.com/api/open/cases</td>
                                            </tr>

                                        </tbody>
                                    </table>
                                </div>
                                <div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-225 height15p card-wrapper">
                <div class = "card 1" style="background-color:#ea5771;">
                    <div style="height:25%; font-size: 20px;">ผู้ติดเชื้อ</div>
                    <div id = "total-case" style="height:50%; font-family: mitr;font-size: 42px;"></div>
                    <div style="height:25%;"><span id = "total-newcase" style="font-size: 20px;"></span></div>
                </div>
            </div>
            <div class="col-sm-225 height15p card-wrapper">
                <div  class = "card 2" style="background-color:#fcc400;">
                    <div style="height:25%; font-size: 20px;">กำลังรักษา</div>
                    <div id = "total-care" style="height:50%; font-family: mitr;font-size: 42px;"></div>
                    <div style="height:25%;"><span id = "total-newcare" style="font-size: 20px;"></span></div>
                </div>
            </div>
            <div class="col-sm-225 height15p card-wrapper">
                <div  class = "card 3" style="background-color:#039245;">
                    <div style="height:25%; font-size: 20px;">หายแล้ว</div>
                    <div id = "total-recover" style="height:50%; font-family: mitr;font-size: 42px;"></div>
                    <div style="height:25%;"><span id = "total-newrecover" style="font-size: 20px;"></span></div>
                </div>    
            </div>
            <div class="col-sm-225 height15p card-wrapper">
                <div  class = "card 4" style="background-color:#d22d36;">
                    <div style="height:25%; font-size: 20px;">เสียชีวิต</div>
                    <div id = "total-decease" style="height:50%; font-family: mitr;font-size: 42px;"></div>
                    <div style="height:25%;"><span id = "total-newdecease" style="font-size: 20px;"></span></div>
                </div>
                <h5 id="update-date" style = "font-size: 12px; color : #aaa;text-align: right; margin-top: 0px; padding-right: 10px;"></h5>    
            </div>
            <div class="col-xs-12 height5p dc-chart-wrapper" id="dc-data-count" style="height: 5%;">
                <div class="h4" style="padding-left: 10px; margin-top: -13px; margin-bottom: 0px; "><img id="logo" src="img\flags\th.png" style="float:left; padding-top:13px; padding-right:10px;" width=40 height=38></img><strong class="filter-count" style="font-size: 46px;">-</strong> <span class="text-sm" style="font-size: 18px;"> ราย ถูกเลือกจาก <strong class="total-count" style="font-size: 24px;">-</strong> ราย  </span><span id="viewFilters" style="font-size: 16px;"></span><span id="confirmed-cases-update" style = "font-size: 12px;color : #aaa; padding-left: 5px"></span>
                </div>
            </div>
            <div class="col-xs-12 height80p" id="zone-Bottom">
                
                <div class="col-sm-3 height100p" id="zone-left">
                    <div class="col-sm-12 height90p dc-chart-wrapper" id="zone-prov" style="position: relative;">
                        <div id="prov-chart-title" class="">┃ ผู้ติดเชื้อแยกตาม<span style="font-size: 24px">จังหวัด</span><span id="prov-reset"></span>

                    <span id="fullextend-trigger" class="" style="padding-top: 16px; font-size: 20px; text-align: center; vertical-align: middle;">
                        <a data-toggle="modal" href="" style="float: right;text-decoration: none;" onclick="toggle_extend('zone-prov')">⌝</a>
                    </span>


                        </div>
                        <div  id="slidercontainer" class="col-xs-9" ><input type="range" class="slider" id="slideRange1" value="10" min="5" max="30" step="1" oninput="updateSlider(this.value)">
                        </div>
                        <div class="col-xs-3" style="height: 15px; margin-top: -7px">
                             Top <span id="sliderValue">10</span>   
                        </div>
                        <div id="prov-chart" style="height: 93%;">
                        </div>

                    </div>

                    <! link for data table>
                    <div id="datatable-trigger" class="col-xs-12 height10p dc-chart-wrapper" style="padding-top: 16px; font-size: 20px; text-align: center; vertical-align: middle;">
                        <a data-toggle="modal" data-target="#datatable-modal" href="" >แสดงตารางข้อมูล</a>
                    </div>

                    <! data table>
                    <div class="modal fade" id="datatable-modal" tabindex="-1" role="dialog" aria-labelledby="datatable-modalLabel" aria-hidden="true" style="padding-top: 15%">


                        <div class="col-xs-12 height50p chart-wrapper">
                            <div class="chart-wrapper"><button type="button" class="close" data-dismiss="modal" aria-label="Close" style="padding-right: 15px; color: #fff;"><span aria-hidden="true">&times;</span></button>
                                <div class="chart-title">┃ ตารางข้อมูลผู้ติดเชื้อโควิด-19 : ข้อมูล <strong id="size" style="font-size: 46px;">-</strong> <span id="totalsize"></span> ราย<span id="confirmed-cases-update2" style = "font-size: 12px;color : #aaa; padding-left: 5px"></span></div>
                                <div class="chart-stage">
                                    <table class="table table-hover" id="data-table" style="min-width: 400px"></table>
                                </div>
                                <div class="chart-notes"><button type="button" class="btn btn-default" data-dismiss="modal" style="font-family: DB Heavent; font-size: 16px; padding: 0px 9px;"><strong>Close</strong></button></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-sm-9 height100p">
                    <div class="col-sm-5 height70p dc-chart-wrapper" id="zone-map" >
                        <div id="map-chart">┃ <span style="font-size: 24px">แผนที่</span>แสดงความหนาแน่นผู้ติดเชื้อ <a class="reset" href="javascript:mapChart.filterAll();dc.redrawAll();" style="display: none;">reset</a><a data-toggle="modal" href="" style="float: right;text-decoration: none;" onclick="toggle_extend('zone-map')">⌝</a>
                        </div>
                    </div>
                    <div class="col-sm-7 height70p" id="zone-nation-nation-age">
                        <div class="col-sm-6 height50p dc-chart-wrapper" id="zone-sex">
                            <div id="sex-chart" class="">┃ ผู้ติดเชื้อแยกตาม<span style="font-size: 24px">เพศ </span><a class="reset" href="javascript:sexChart.filterAll();dc.redrawAll();" style="display: none;">reset</a><a data-toggle="modal" href="" style="float: right;text-decoration: none;" onclick="toggle_extend('zone-sex')">⌝</a>
                            </div>
                        </div>
                        <div class="col-sm-6 height50p dc-chart-wrapper" id="zone-nation">
                            <div id="nation-chart-title" class="">┃ ผู้ติดเชื้อแยกตาม<span style="font-size: 24px">สัญชาติ</span><span id="nation-reset"></span><a data-toggle="modal" href="" style="float: right;text-decoration: none;" onclick="toggle_extend('zone-nation')">⌝</a>
                            </div>

                            <div  id="slidercontainer2" class="col-xs-9" ><input type="range" class="slider" id="slideRange1" value="10" min="5" max="30" step="1" oninput="updateSlider2(this.value)">
                            </div>
                            <div class="col-xs-3" style="height: 15px; margin-top: -7px">
                                 Top <span id="sliderValue2">7</span>   
                            </div>

                            <div id="nation-chart" style="height: 93%">
                            </div>
                        </div>
                        <div class="col-xs-12 height50p dc-chart-wrapper" id="zone-age">
                            <div id="age-chart" class="">┃ ผู้ติดเชื้อแยกตาม<span style="font-size: 24px">อายุ </span><a class="reset" href="javascript:ageChart.filterAll();dc.redrawAll();" style="display: none;">reset</a><a data-toggle="modal" href="" style="float: right;text-decoration: none;" onclick="toggle_extend('zone-age')">⌝</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 height30p dc-chart-wrapper" id="zone-date">
                        <div id="date-chart" class="" style=" height: 90%;">┃ ผู้ติดเชื้อ<span style="font-size: 24px;">รายวัน </span><a class="reset" href="javascript:dateChart.filterAll();dc.redrawAll();" style="display: none;">reset</a><a data-toggle="modal" href="" style="float: right;text-decoration: none;" onclick="toggle_extend('zone-date')">⌝</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="js\covid19.js"></script>
    <!script src="js\d3.js"><!/script>
    <!script src="js\crossfilter.js"><!/script>
    <!script src="js\dc.js"><!/script>

    <script>
        setheight();
        var goldenRatio = 1.618034,
            transitionDuration = 200,
            minHeight = 500,
            svgPadding = 30,
            Theme_Color = "#008fff";//#0ab4f3",//"#FF6900";
            //Theme_Color_Range = d3.scaleLinear().domain([1,150]).range(["white", "blue"]);
            //Theme_Color_Range = d3.scaleSequential().domain([1,150]).interpolator(d3.interpolateViridis);
            Theme_Color_Range = [/*"#f8fbff", "#deecf8",*/ "#c6dbef", "#9ecae1", "#6baed6", "#4292c6", "#2171b5", "#07519c", "#253494", "#071d58", /*"#e10609", "#e10609", "#800026"*/,"#800026", "#800026", "#800026"],
            //["#FFE1CC", "#FFD5B7", "#FFC9A3", "#FFBD8E", "#FFB17A", "#FFA566", "#FF9951", "#FF8D3D", "#FF8128", "#FF7514", "#FF6900"];
            slider1 = 10,
            slider2 = 7;
        var a,b,
            brush = !1,
            extenddiv,
            extend = !1,
            before_style = {width:"0",height:"0"};


//        var sliderDiv = document.getElementById("sliderValue"),
//            inputslide = document.getElementById("slidercontainer");
        
        var provChart = dc.rowChart("#prov-chart"),
            dateChart = dc.lineChart("#date-chart"),
            mapChart = dc.geoChoroplethChart("#map-chart"),
            ageChart = dc.barChart("#age-chart"),
            nationChart = dc.rowChart("#nation-chart"),
            sexChart = dc.pieChart("#sex-chart"),
            dataTable = dc.dataTable('#data-table');

        var tooltip = d3.select("body")
            .append("div")
            .style({
                "position": "absolute",
                "z-index": "10",
                "visibility": "hidden"
            })
            .attr({
                "class": "tooltip"
            });



            d3.json("https://covid19.th-stat.com/api/open/today", function(todayjson) {
            //d3.json("https://Tunchz.github.io/covid19_today.json", function(todayjson) {

                //console.log(datajson);
                d3.json("https://covid19.th-stat.com/api/open/cases", function(datajson) { 
                //d3.json("https://Tunchz.github.io/covid19_case.json", function(datajson) { 
                    var y = datajson.Data;


                d3.json("https://Tunchz.github.io/mapth_small_+unknown.json", function(mapjson) {
                    var t = d3.time.format("%Y-%m-%d %H:%M:%S")
                        t2 = d3.time.format("%d-%b-%y");
                    //console.log(json);
                    d3.format(".2f");
                    //console.log(y);

                    var today = Date.now();
/*                        ,
                        temp = crossfilter(y),
                        nt_temp = temp.dimension(function(e) {
                            return e.Nation
                        }),
                        N_temp = nt_temp.group()
                        Nation_top10 = [];
*/

                        //console.log(today);
/*
                    for (i=0;i<10;i++){
                        Nation_top10[i] = N_temp.top(10)[i].key
                    }
*/

                    //console.log(Nation_top10);
                    //console.log(Nation_top10.includes("ไทย"));


                    y.forEach(function(e, a) {
                        e.date = t.parse(e["ConfirmDate"])
                        delete e["ConfirmDate"]
                        e.Province === "กทม" ? e.Province = "กรุงเทพมหานคร" : e.Province === "" ? e.Province = "ไม่พบข้อมูล" : e.Province = e.Province.trim()
                        //e.Province === "ไม่พบข้อมูล" ? e.Province_filtered = "" : e.Province_filtered = e.Province
                        e.Province_filtered = e.Province
                        e.Gender === "" ? e.Gender = "ไม่พบข้อมูล" : e.Gender = e.Gender.trim()
                        //Nation_top10.includes(e.Nation) ? e.NationTop10 = e.Nation : e.NationTop10 = "ประเทศอื่นๆ"

                    });
                    //console.log(datajson.UpdateDate);
                    

                    




                    //console.log(remove_unknown(a))
                        a = crossfilter(y);
                    var totalcase = y.length,
                        k1 = crossfilter(todayjson),
                        k = k1.groupAll(),
                        r/*, a */= crossfilter(y),
                        i = a.groupAll(),
                        u = a.dimension(function(e) {return e.Province}),
//                        b = u.group(),
                        c = a.dimension(function(e) {return e.Province_filtered}),
                        s = c.group(),//.reduceSum(function(e) {return e.Province_filtered === "" ? 0 : 1}),
                        //c_temp = c,
                        //c_unknown = c.filter(function(d){return d.Province = "ไม่พบข้อมูล"}),
                        //c_unknown = c_temp.filter("กรุงเทพมหานคร"),
                        //s_unknown = c_unknown.group(),

                        n = a.dimension(function(e) {return e.date}),
                        o = n.group(),

                        accumdateGroup = accumulate_group(o);

                        d = a.dimension(function(e) {return e.Age}),
                        l = d.group().reduceSum(function(e) {return e.Age === 0  ? 0 : 1}),
                        g = a.dimension(function(e) {return e.Gender}),
                        S = g.group(),
                        nt = a.dimension(function(e) {return e.Nation}),
                        N = nt.group(),

                        agerange = a.dimension(e => {   
                            a_ = e.Age;
                            if (a_ == 0) {
                                return 'ไม่ระบุ';
                            } else if (a_ <= 10) {
                                return '1 - 10 ปี';
                            } else if (a_ <= 20) {
                                return '11 - 20 ปี';
                            } else if (a_ <= 30) {
                                return '21 - 30 ปี';
                            } else if (a_ <= 40) {
                                return '31 - 40 ปี';
                            } else if (a_ <= 50) {
                                return '41 - 50 ปี';
                            } else if (a_ <= 60) {
                                return '51 - 60 ปี';
                            } else if (a_ <= 70) {
                                return '61 - 70 ปี';
                            } else if (a_ <= 80) {
                                return '71 - 80 ปี';
                            } else if (a_ <= 90) {
                                return '91 - 90 ปี';
                            } else if (a_ > 90) {
                                return 'มากกว่า 90 ปี';
                            } else {
                                return 'ไม่ระบุ';
                            }
                        }),
                        ageGroup = agerange.group()/*.reduceSum(function(e) {
                            return 1
                        })*/
                        ;
                        b = u.group();



                        //console.log(o);

/*
                        for (var j = 0; j < mapjson.features.length; j++) {
                            var jsonState = mapjson.features[j].properties.PROVINCE_N,
                                prov = b.all();
                                
                            for (var ii = 0; ii < prov.length; ii++) {
                                if (prov[ii].key == jsonState) {
                                    mapjson.features[j].properties.Pop = prov[ii].value;
                                    break; 
                                } 
                                else {
                                   mapjson.features[j].properties.Pop = 0; 
                    
                                }
                            }
                        }       

                        //console.log(mapjson);
*/


                    //console.log(ageGroup.top(10))
                    //console.log(c_unknown.group().top(2))
                    var formatComma = d3.format(",");

                    document.getElementById("total-case").innerHTML = todayjson.Confirmed;
                    document.getElementById("total-newcase").innerHTML = displaytexttotal(todayjson.NewConfirmed);
                    document.getElementById("total-care").innerHTML = todayjson.Hospitalized;
                    document.getElementById("total-newcare").innerHTML = displaytexttotal(todayjson.NewHospitalized);
                    document.getElementById("total-recover").innerHTML = todayjson.Recovered;
                    document.getElementById("total-newrecover").innerHTML = displaytexttotal(todayjson.NewRecovered);
                    document.getElementById("total-decease").innerHTML = todayjson.Deaths;
                    document.getElementById("total-newdecease").innerHTML = displaytexttotal(todayjson.NewDeaths);

                    document.getElementById("update-date").innerHTML = "ข้อมูลสรุปผู้ติดเชื้อรายวันอัปเดตล่าสุด : " + todayjson.UpdateDate +" ";
                    document.getElementById("confirmed-cases-update").innerHTML = "  ข้อมูลยืนยันผู้ติดเชื้อสะสมอัปเดตล่าสุด : " + datajson.UpdateDate +" ";
                    document.getElementById("confirmed-cases-update2").innerHTML = "  ข้อมูลยืนยันผู้ติดเชื้อสะสมอัปเดตล่าสุด : " + datajson.UpdateDate +" ";

                    
                    var m = document.getElementById("zone-prov").offsetWidth - svgPadding,
                        h = document.getElementById("zone-prov").offsetHeight - svgPadding-50;
                    provChart.width(m).height(h).margins({top: 0, left: 10, right: 10, bottom: 0})
                        .transitionDuration(transitionDuration)
                        .dimension(c)
                        .group(s)
                        .data(function (group) { return group.top(slider1);})
                        .colors(Theme_Color).label(function(e) {return e.key+ "  " + e.value + " ราย"})
                        .ordering(function(e) { return -e.value; })
                        //.title(function(e) {return e.key + " : " + e.value + " ราย"})
                        .title(function(e) {return ""})
                        .gap(1)
                        .elasticX(!0)
                        .xAxis()/*.orient("top")*/.ticks(3)
                        , window.onresize = function(e) {
                            var a = r.keyAccessor()(e);
                            dc.events.trigger(function() {
                                r.filter(null), r.filter(a), r.redrawGroup()
                            })
                            provChart.width(m).height(h).transitionDuration(0), dc.renderAll(), ageChart.transitionDuration(transitionDuration), dateChart.transitionDuration(transitionDuration), nationChart.transitionDuration(transitionDuration), sexChart.transitionDuration(transitionDuration), mapChart.transitionDuration(transitionDuration)

                    };
/*
                    var provChartEx = dc.rowChart("#prov-chart-extend");
                    var mx = document.getElementById("wholecontent").offsetWidth - svgPadding,
                        hx = document.getElementById("wholecontent").offsetHeight*0.8 - svgPadding-50;
                    provChartEx.width(mx).height(hx).margins({top: 0, left: 10, right: 10, bottom: 0})
                        .transitionDuration(transitionDuration)
                        .dimension(c)
                        .group(s)
                        .data(function (group) { return group.top(slider1);})
                        .colors(Theme_Color).label(function(e) {return e.key+ "  " + e.value + " ราย"})
                        .ordering(function(e) { return -e.value; })
                        //.title(function(e) {return e.key + " : " + e.value + " ราย"})
                        .title(function(e) {return ""})
                        .gap(1)
                        .elasticX(!0)
                        .xAxis().ticks(3)
                        , window.onresize = function(e) {
                            var a = r.keyAccessor()(e);
                            dc.events.trigger(function() {
                                r.filter(null), r.filter(a), r.redrawGroup()
                            })
                            provChart.width(m).height(h).transitionDuration(0), dc.renderAll(), ageChart.transitionDuration(transitionDuration), dateChart.transitionDuration(transitionDuration), nationChart.transitionDuration(transitionDuration), sexChart.transitionDuration(transitionDuration), mapChart.transitionDuration(transitionDuration)

                    };

*/



                    var p = d3.min(y, function(e) {return e.date}),
                        k = d3.max(y, function(e) {return e.date}),
                        j = document.getElementById("zone-date").offsetWidth - svgPadding,
                        f = document.getElementById("zone-date").offsetHeight - svgPadding;
                    dateChart.width(j).height(f).margins({
                        top: 10,
                        right: 10,
                        bottom: 55,
                        left: 40
                        }).dimension(n)
                        .group(o, "จำนวนผู้ป่วยรายวัน")
                        .stack(accumdateGroup, 'จำนวนผู้ป่วยสะสม')
                        .x(d3.time.scale().domain([p/*.setMonth(p.getMonth() - 1)*/, today/*k/*.setMonth(k.getMonth() + 1)*/])).round(d3.time.day.round)
                        .renderArea(!0).transitionDuration(transitionDuration)
                        .elasticY(!0)
                        .renderHorizontalGridLines(!0)
                        .legend(dc.legend().x(50).y(20).itemHeight(10).gap(5))
                        .title(function(e) {return ""})
                        .brushOn(brush/*!1*/).mouseZoomable(!1)
                        //.colors(Theme_Color)
                        .ordinalColors(['#008fff','#e10609'/*'#800026','#e55e00'*/])
                        //.colors(d3.scale.quantize().range(["#800026", "#800026"]))
                        //.xAxisLabel("วัน/เดือน/ปี", 10)
                        //.rederDataPoints(!0)
                        //.dotRadius(3)
                        //.interpolate(!0)
                        //.xyTipsOn(!0)
                        .yAxis().ticks(3);
 



                    var v = document.getElementById("zone-map").offsetWidth,// - svgPadding,
                        C = document.getElementById("zone-map").offsetHeight;// - svgPadding;
                    mapChart.width(v).height(C).dimension(u).group(b).transitionDuration(200)
                            .projection(d3.geo.mercator().rotate([-100.6331, -13.2]).translate([v / 2, C / 2]).center([1.5, -1.1]).scale(2.478*Math.min(v*1.872, C-69)+541))
                            .overlayGeoJson(mapjson.features, "PROVINCE_N", function(e) {e.properties.value = e.value; return e.properties.PROVINCE_N})
                            .colors(d3.scale.quantize().range(Theme_Color_Range))
                            .colorDomain([-8, 100/*b.top(2)[0].key === "ไม่พบข้อมูล" ? b.top(2)[1].value : b.top(2)[0].value*/])
                            .label(function(e) {return 15/*e.value*/})
                            //.title(function(e) {return e.value/*"จังหวัด : " + e.key + "\nจำนวนผู้ติดเชื้อ : " + e.value + " คน"*/})
                            .title(function(e) {return ""})
    




//console.log(b.top(Infinity).filter(function(e) { return e.key == "นครนายก"})[0].value);
//console.log(N.top(5))
                    

                    var Nw = document.getElementById("zone-sex").offsetWidth - svgPadding,
                        Nh = document.getElementById("zone-sex").offsetHeight - svgPadding;                    
                    sexChart
                        .width(Nw)
                        .height(Nh)
                        .cx(Nw/2+10).cy(Nh/2-10)
                        .radius(Math.min(Nw,Nh)*4/10)
                        .innerRadius(Math.min(Nw,Nh)*3/10)
                        .dimension(g)
                        .group(S)
                        .externalLabels(10)
                        .legend(dc.legend().x((Nw/2)-Math.min(Nw,Nh)/7+10).y(Nh/2-Math.min(Nw,Nh)/9-10).itemHeight(10).gap(5))
                        .ordering(function(e) { return e.value; })
                        //.title(function(e) {return e.key + " : "+ e.value+ " ราย (" + (e.value/totalcase*100).toFixed(2)+"%)"})
                        .title(function(e) {return ""})
                        .label(function(e) {return /*e.key + " " + */(e.value/totalcase*100).toFixed(2)+"%"
                        })
                        .ordinalColors(['#008fff','#ea5771','#dadada'])
                        .ordering(function(d) { return d.key === "ชาย" ? 1: d.key === "หญิง" ? 2: 3 });






                    var E = document.getElementById("zone-age").offsetWidth - svgPadding,
                        P = document.getElementById("zone-age").offsetHeight - svgPadding;
                    ageChart.width(E).height(P).margins({ top: 10, right: 0, bottom: 35, left: 30})
                        .dimension(d)
                        .group(l)
                        .transitionDuration(transitionDuration)
                        .elasticY(!0).centerBar(!1).gap(1)
                        .colors(Theme_Color).round(dc.round.floor).alwaysUseRounding(!0)
                        .x(d3.scale.linear().domain([0, 100]))
                        .renderHorizontalGridLines(!0)
                        .brushOn(brush)
                        .title(function(e) {return ""})
                        //.legend(dc.legend().x(30).y(20).itemHeight(10).gap(5))
                        .yAxis().ticks(3);

/*                    ageChart.width(E).height(P).margins({ top: 10, right: 0, bottom: 35, left: 30})
                        .dimension(agerange)
                        .group(ageGroup)
                        .transitionDuration(transitionDuration)
                        .elasticY(!0).centerBar(!1).gap(1)
                        .colors(Theme_Color).round(dc.round.floor).alwaysUseRounding(!0)
                        //.x(d3.scale.linear().domain([0, 100]))
                        .x(d3.scale.ordinal().domain(['1 - 10 ปี','11 - 20 ปี','21 - 30 ปี','31 - 40 ปี','41 - 50 ปี','51 - 60 ปี','61 - 70 ปี','71 - 80 ปี','91 - 90 ปี','มากกว่า 90 ปี','ไม่ระบุ']))
                        .xUnits(dc.units.ordinal)
                        .renderHorizontalGridLines(!0)
                        .brushOn(brush/)
                        .title(function(e) {return ""})
                        //.legend(dc.legend().x(30).y(20).itemHeight(10).gap(5))
                        .yAxis().ticks(3);
*/



                    var A = document.getElementById("zone-nation").offsetWidth - svgPadding,
                        R = document.getElementById("zone-nation").offsetHeight - svgPadding;

                    //console.log(document.getElementById("zone-sex"));
                    nationChart.width(A).height(R)
                        .margins({top:0, left:10, right:0, bottom:55})
                        .dimension(nt).group(N).transitionDuration(transitionDuration)
                        .data(function (group) { return group.top(slider2);})
                        .gap(1)
                        .colors(Theme_Color)
                        .label(function(e) {return e.key})
                        //.title(function(e) {return e.key + " : " + e.value + " ราย"})
                        .title(function(e) {return ""})
                        .label(function(e) {return e.key + " " + e.value + " ราย ("+ (e.value/totalcase*100).toFixed(2)+"%)"})
                        //.labelOffsetX(-10)
                        .ordering(function(e) { return e.key === "ประเทศอื่นๆ" ? 0 : -e.value; })
                        .elasticX(!0).xAxis().ticks(3);


                    dataTable
                        .dimension(n)
                        .group(function(d) {return "";})
                        .columns([
                        //{label: ' ', format: function(e) {return e.index;}},
                        {label: 'วันที่',
                            format: function (e) {
                                return (e.date).getDate()+"/"+e.date.getMonth()+1+"/"+(e.date.getYear()+1900);
                            }
                        },
                        {label: 'สัญชาติ', format: function(e) {return e.Nation;}},
                        {label: 'อายุ', format: function(e) {return e.Age;}},
                        {label: 'เพศ', format: function(e) {return e.Gender;}},
                        {label: 'จังหวัด', format: function(e) {return e.Province;}},
                
                        ])
                        .sortBy(function(e) {return e.date})
                        .order(d3.ascending)
                        .size(totalcase)

                    ,window.onresize = function(e) {
                        setheight();
                        if (extend) {display_extend();};
                        var a = document.getElementById("zone-prov").offsetWidth - svgPadding,
                            t = document.getElementById("zone-prov").offsetHeight - svgPadding-50;
                        provChart.width(a).height(t).transitionDuration(0);
                        var r = document.getElementById("zone-date").offsetWidth - svgPadding,
                            i = document.getElementById("zone-date").offsetHeight - svgPadding;
                        dateChart.width(r).height(i).transitionDuration(0);
                        var c = document.getElementById("zone-age").offsetWidth - svgPadding,
                            s = document.getElementById("zone-age").offsetHeight - svgPadding;
                        ageChart.width(c).height(s).transitionDuration(0);
                        var v = document.getElementById("zone-map").offsetWidth// - svgPadding,
                            C = document.getElementById("zone-map").offsetHeight;// - svgPadding;
                        mapChart.width(v).height(C).projection(d3.geo.mercator().rotate([-100.6331, -13.2]).translate([v / 2, C / 2]).center([1.5, -1.1]).scale(2.478*Math.min(v*1.872, C-69)+541+50)).transitionDuration(0);
                        var n = document.getElementById("zone-nation").offsetWidth - svgPadding,
                            o = document.getElementById("zone-nation").offsetHeight - svgPadding;
                        nationChart.width(n).height(o).transitionDuration(0);
                        var Nw = document.getElementById("zone-sex").offsetWidth - svgPadding,
                            Nh = document.getElementById("zone-sex").offsetHeight - svgPadding;                  
                        sexChart.width(Nw).height(Nh).cx(Nw/2+10).cy(Nh/2-10).radius(Math.min(Nw,Nh)*4/10).innerRadius(Math.min(Nw,Nh)*3/10).transitionDuration(0).legend(dc.legend().x((Nw/2)-Math.min(Nw,Nh)/7+10).y(Nh/2-Math.min(Nw,Nh)/9-10).itemHeight(10).gap(5)), 
                        dc.renderAll(),
                        provChart.transitionDuration(transitionDuration), 
                        dateChart.transitionDuration(transitionDuration), 
                        ageChart.transitionDuration(transitionDuration), 
                        nationChart.transitionDuration(transitionDuration), 
                        mapChart.transitionDuration(transitionDuration),
                        sexChart.transitionDuration(transitionDuration),

                        d3.selectAll("#sex-chart g path").on("mouseover", showSexDetail).on("mouseout", hideDetail),
                        d3.selectAll("#map-chart g path").on("mouseover", showMapDetail).on("mouseout", hideDetail),
                        d3.selectAll("#prov-chart g rect").on("mouseover", showProvDetail).on("mouseout", hideDetail),
                        d3.selectAll("#prov-chart g text").on("mouseover", showProvDetail).on("mouseout", hideDetail),
                        d3.selectAll("#nation-chart g rect").on("mouseover", showNationDetail).on("mouseout", hideDetail),
                        d3.selectAll("#nation-chart g text").on("mouseover", showNationDetail).on("mouseout", hideDetail),
                        d3.selectAll("#age-chart rect.bar").on("mouseover", showAgeDetail).on("mouseout", hideDetail),
                        d3.selectAll("#date-chart g circle").on("mouseover", showDateDetail),
                        d3.selectAll("#date-chart g g g").on("mouseout", hideDetail),

                        agechart_add_togglebrush(),
                        datechart_add_togglebrush()

                    }; 
 


                    dc.dataCount("#dc-data-count").dimension(a).group(i), 
                    dc.renderlet(function(e) {
                        dc.events.trigger(function() {
                            display(),
                            $("#viewFilters").html(""), 
                             0 != provChart.filters().length && $("#viewFilters").append('<i class="fa fa-filter"></i> <span class="text-bg">จังหวัด</span>=<span class="text-md">' + provChart.filters() + "</span> "), 
                            0 != mapChart.filters().length && $("#viewFilters").append('<i class="fa fa-filter"></i> <span class="text-bg">จังหวัด</span>=<span class="text-md">' + mapChart.filters() + "</span> "), 
                            0 != sexChart.filters().length && $("#viewFilters").append('<i class="fa fa-filter"></i> <span class="text-bg">เพศ</span>=<span class="text-md">' + sexChart.filters() + "</span> ") ,
                            0 != nationChart.filters().length && $("#viewFilters").append('<i class="fa fa-filter"></i> <span class="text-bg">สัญชาติ</span>=<span class="text-md">' + nationChart.filters() + "</span> "), 
                            0 != ageChart.filters().length && $("#viewFilters").append('<i class="fa fa-filter"></i> <span class="text-bg">อายุ</span>=<span class="text-md">' + ageChart.filters() + "</span> "), 
                            0 != dateChart.filters().length && $("#viewFilters").append('<i class="fa fa-filter"></i> <span class="text-bg">ช่วงวัน</span>=<span class="text-md">[' + t(dateChart.filters()[0][0]) + ", " + t(dateChart.filters()[0][1]) + "]</span> "), 
                            0 == provChart.filters().length && 0 == dateChart.filters().length && 0 == mapChart.filters().length && 0 == ageChart.filters().length && 0 == nationChart.filters().length && 0 == sexChart.filters().length || $("#viewFilters").append('<a href="javascript:dc.filterAll();dc.redrawAll();"><btn-primary><strong>Reset All</strong></btn></a>'),
                            $("#prov-reset").html(""),0 != provChart.filters().length && $("#prov-reset").append('<a href="javascript:provChart.filterAll();dc.redrawAll();"><btn-primary> reset</btn></a>'),
                            $("#nation-reset").html(""),0 != nationChart.filters().length && $("#nation-reset").append('<a href="javascript:nationChart.filterAll();dc.redrawAll();"><btn-primary> reset</btn></a>')

                   })
                    }), 

                    dc.renderAll(),


                    
                    slidercontainer.oninput = function() {
                    
                        var a = document.getElementById("zone-prov").offsetWidth - svgPadding,
                            t = document.getElementById("zone-prov").offsetHeight - svgPadding-60;
                        provChart.width(a).height(t).transitionDuration(0);
                        provChart.render(),
                        provChart.transitionDuration(transitionDuration),
                        d3.selectAll("#prov-chart g rect").on("mouseover", showProvDetail).on("mouseout", hideDetail), 
                        d3.selectAll("#prov-chart g text").on("mouseover", showProvDetail).on("mouseout", hideDetail) 
                    },

                    slidercontainer2.oninput = function() {
                        var n = document.getElementById("zone-nation").offsetWidth - svgPadding,
                            o = document.getElementById("zone-nation").offsetHeight - svgPadding;
                        nationChart.width(n).height(o).transitionDuration(0);
                        nationChart.render(),
                        nationChart.transitionDuration(transitionDuration),
                        d3.selectAll("#nation-chart g rect").on("mouseover", showNationDetail).on("mouseout", hideDetail),
                        d3.selectAll("#nation-chart g text").on("mouseover", showNationDetail).on("mouseout", hideDetail) 
                    },

                    //Display tooltips
                    d3.selectAll("#sex-chart g path").on("mouseover", showSexDetail).on("mouseout", hideDetail),
                    d3.selectAll("#map-chart g path").on("mouseover", showMapDetail).on("mouseout", hideDetail) ,
                    d3.selectAll("#prov-chart g rect").on("mouseover", showProvDetail).on("mouseout", hideDetail),
                    d3.selectAll("#prov-chart g text").on("mouseover", showProvDetail).on("mouseout", hideDetail),
                    d3.selectAll("#nation-chart g rect").on("mouseover", showNationDetail).on("mouseout", hideDetail),
                    d3.selectAll("#nation-chart g text").on("mouseover", showNationDetail).on("mouseout", hideDetail),
                    d3.selectAll("#age-chart rect.bar").on("mouseover", showAgeDetail).on("mouseout", hideDetail),
                    d3.selectAll("#date-chart g circle").on("mouseover", showDateDetail),d3.selectAll("#date-chart g g g").on("mouseout", hideDetail),

                    agechart_togglebrush(),
                    datechart_togglebrush()



                })      //d3.json--map

                })      //d3.json--data
                
                
            });         //d3.json--today


    function agechart_add_togglebrush() {
        //agebrush = !agebrush;
        ageChart.brushOn(brush).transitionDuration(0);
        ageChart.render(),
        ageChart.transitionDuration(transitionDuration),
        d3.selectAll("#age-chart rect.bar").on("mouseover", showAgeDetail).on("mouseout", hideDetail),

        ageChart.selectAll("svg").select("g").select("g.axis.x")
            //.append("g")
            .append("rect")
            .attr({
                class: "toggle-area",
                x : 0,
                y : 0,
                height : 20, 
                width : document.getElementById("zone-age").offsetWidth,
                fill : "#fff",
                opacity : 0
            })
            .append("title")
            .text( brush === !0 ? "Brush Mode >> click to toggle Tooltips Mode":"Tooltips Mode >> click to toggle Brush Mode"
            ),

        d3.selectAll("#age-chart rect.toggle-area").on("click", agechart_togglebrush)
    }


    function datechart_add_togglebrush() {
        //datebrush = !datebrush;
        dateChart.brushOn(brush).transitionDuration(0);
        dateChart.render(),
        dateChart.transitionDuration(transitionDuration),
        d3.selectAll("#date-chart g circle").on("mouseover", showDateDetail),d3.selectAll("#date-chart g g g").on("mouseout", hideDetail),

        dateChart.selectAll("svg").select("g").select("g.axis.x")
            //.append("g")
            .append("rect")
            .attr({
                class: "toggle-area",
                x : 0,
                y : 0,
                height : 35, 
                width : document.getElementById("zone-date").offsetWidth,
                fill : "#fff",
                opacity : 0
            })
            .append("title")
            .text( brush === !0 ? "Brush Mode >> click to toggle Tooltips Mode":"Tooltips Mode >> click to toggle Brush Mode"
            ),

        d3.selectAll("#date-chart rect.toggle-area").on("click", datechart_togglebrush)
    }

    function agechart_togglebrush() {
        brush = !brush;
        agechart_add_togglebrush(),
        datechart_add_togglebrush()
    }

    function datechart_togglebrush() {
        brush = !brush;
        datechart_add_togglebrush(),
        agechart_add_togglebrush()
    }

    function showMapDetail() {

        // show tooltip with information from the __data__ property of the element
        var d = this.__data__;
        var key = d.properties.PROVINCE_N;
        var prov_data = b.top(Infinity).filter(function(e) { return e.key == key});
        var value = prov_data.length === 1 ? prov_data[0].value : 0;
        //console.log(prov_data.length === 1 ? prov_data[0].value : 0);
        var content = "<b>"+ key + "<br><span style=\" font-size : 30px\">" + value + "</span><b><br>ราย";

        return tooltip.style({
                "visibility": "visible",
                "text-align": "center",
                "top": (event.pageY - 10) + "px",
                "left": (event.pageX + 10) + "px"
            })
            .html(content);
    }
   

    function showSexDetail() {

        // show tooltip with information from the __data__ property of the element
        var d = this.__data__;
        //var program = d.layer;
        var value = d.data.value;
        var key = d.data.key;
        
        var content = "<b>" + key + "<br><span style=\" font-size : 30px\">" + value + "</span><b> ราย";

        return tooltip.style({
                "visibility": "visible",
                "text-align": "left",
                "top": (event.pageY - 10) + "px",
                "left": (event.pageX + 10) + "px"
            })
            .html(content);
    }

    function showProvDetail() {

        // show tooltip with information from the __data__ property of the element
        var d = this.__data__;
        //var program = d.layer;
        var value = d.value;
        var key = d.key;
        
        var content = "<b>" + key + "<br><span style=\" font-size : 30px\">" + value + "</span><b> ราย";
        return tooltip.style({
                "visibility": "visible",
                "text-align": "left",
                "top": (event.pageY - 10) + "px",
                "left": (event.pageX + 10) + "px"
            })
            .html(content);
    }

    function showNationDetail() {

        // show tooltip with information from the __data__ property of the element
        var d = this.__data__;
        //var program = d.layer;
        var value = d.value;
        var key = d.key;
        
        var content = "<b>" + key + "<br><span style=\" font-size : 30px\">" + value + "</span><b> ราย";

        return tooltip.style({
                "visibility": "visible",
                "text-align": "left",
                "top": (event.pageY - 10) + "px",
                "left": (event.pageX + 10) + "px"
            })
            .html(content);
    }

    function showAgeDetail() {

        // show tooltip with information from the __data__ property of the element
        var d = this.__data__;
        //var program = d.layer;
        var value = d.data.value;
        var key = d.data.key;
        
        var content = "อายุ <b>" + key + "<br><span style=\" font-size : 30px\">" + value + "</span><b><br>ราย";

        return tooltip.style({
                "visibility": "visible",
                "text-align": "center",
                "top": (event.pageY - 10) + "px",
                "left": (event.pageX + 10) + "px"
            })
            .html(content);
    }

    function showDateDetail() {

        // show tooltip with information from the __data__ property of the element
        var d = this.__data__;
        var layer = d.layer;
        var value = d.data.value;
        var key = d.data.key;
        //console.log(d);
        var content =  "<b>" + layer + "</b><br>" + "วัน <b> " + 
            key.getDate()+"/"+(key.getMonth()+1)+"/"+(key.getYear()+1900) + 
            "</b><br>" + value + " ราย";

        return tooltip.style({
                "visibility": "visible",
                "text-align": "left",
                "top": (event.pageY - 10) + "px",
                "left": (event.pageX + 10) + "px"
            })
            .html(content);
    }

    function hideDetail() {

        // hide tooltip
        return tooltip.style("visibility", "hidden");
    }



    function accumulate_group(source_group) {
        return {
            all:function () {
                var cumulate = 0;
                return source_group.all().map(function(d) {
                    cumulate += d.value;
                    return {key:d.key, value:cumulate};
                });
            }
        };
    }


    //## change slider score value to re-assign the data in pie chart
    function updateSlider(slideValue) {
        //var sliderDiv = document.getElementById("sliderValue");
        document.getElementById("sliderValue").innerHTML = slideValue;
        slider1 = document.getElementById("sliderValue").innerHTML;
    }

    function updateSlider2(slideValue2) {
        //var sliderDiv = document.getElementById("sliderValue");
        document.getElementById("sliderValue2").innerHTML = slideValue2;
        slider2 = document.getElementById("sliderValue2").innerHTML;
    }

    function display() {
        var totFilteredRecs = a.groupAll().value();
        d3.select('#size').text(totFilteredRecs);
        if(totFilteredRecs != a.size()){
            d3.select('#totalsize').text("ราย ถูกเลือกจาก " + a.size() + "");
        }else{
            d3.select('#totalsize').text('');
        }

      }
    function displaytexttotal(d) {
        if (d > 0) {
            return "เพิ่ม " + Math.abs(d) + " ราย";
        } 
        else if (d < 0) {
            return "ลด " + Math.abs(d) + " ราย";
        }
        else {
            return "ไม่เปลี่ยนแปลง";
        }
    }

    function setheight() {

        if($("#wholecontent").width() < 741){
            $(".card-wrapper").height(120);
            $("#zone-map").height(700);
            $("#zone-nation-nation-age").height(600);
            $("#zone-date").height(300);
        } else {
            $(".card-wrapper").height("0%");
            $("#zone-map").height("50%");
            $("#zone-nation-nation-age").height("70%");
            $("#zone-date").height("10%");
        }
    }

    function toggle_extend(a) {
        if (extend ||$("#wholecontent").width()>740){
            extenddiv = a;
            display_extend();
            update_extended_chart()
        }
    }    

    function display_extend() {
        if (extend ||$("#wholecontent").width()>740){
            if (extend){
                document.getElementById(extenddiv).style.marginLeft = "";
                document.getElementById(extenddiv).style.position = "relative";
                document.getElementById(extenddiv).style.zIndex = 0;
                document.getElementById(extenddiv).style.height = before_style.height;
                document.getElementById(extenddiv).style.width = before_style.width;
            } 
            else {
                before_style.height = document.getElementById(extenddiv).style.height;
                before_style.width = document.getElementById(extenddiv).style.width;
                document.getElementById(extenddiv).style.position = "fixed";
                document.getElementById(extenddiv).style.zIndex = 10;
                var offset_left = document.getElementById(extenddiv).offsetLeft - 5;
                document.getElementById(extenddiv).style.marginLeft = "-" + (document.getElementById(extenddiv).offsetLeft - 5) + "px";
                document.getElementById(extenddiv).style.position = "absolute";
                $("#"+extenddiv).width($("#wholecontent").width()-16);
                $("#"+extenddiv).height($("#wholecontent").height()*0.8-16);
            }

        }

      extend = !extend;
    }

    function update_extended_chart(){
        if(extenddiv == "zone-prov") {
            var a = document.getElementById("zone-prov").offsetWidth - svgPadding,
                t = document.getElementById("zone-prov").offsetHeight - svgPadding-50;
            provChart.width(a).height(t);
            provChart.render();
            d3.selectAll("#prov-chart g rect").on("mouseover", showProvDetail).on("mouseout", hideDetail);
            d3.selectAll("#prov-chart g text").on("mouseover", showProvDetail).on("mouseout", hideDetail);
        } else if (extenddiv == "zone-date") {
            if (extend) {document.getElementById("date-chart").style.height = "94%";}
            else {document.getElementById("date-chart").style.height = "90%";};
            var r = document.getElementById("zone-date").offsetWidth - svgPadding,
                i = document.getElementById("zone-date").offsetHeight - svgPadding;
            dateChart.width(r).height(i).transitionDuration(0);
            dateChart.render();
            datechart_add_togglebrush();
            d3.selectAll("#date-chart g circle").on("mouseover", showDateDetail),d3.selectAll("#date-chart g g g").on("mouseout", hideDetail);
        } else if (extenddiv == "zone-age") {
            var c = document.getElementById("zone-age").offsetWidth - svgPadding,
                s = document.getElementById("zone-age").offsetHeight - svgPadding;
            ageChart.width(c).height(s).transitionDuration(0);
            ageChart.render();
            agechart_add_togglebrush();
            d3.selectAll("#age-chart rect.bar").on("mouseover", showAgeDetail).on("mouseout", hideDetail);
        } else if (extenddiv == "zone-map") {
            var v = document.getElementById("zone-map").offsetWidth// - svgPadding,
                C = document.getElementById("zone-map").offsetHeight;// - svgPadding;
            mapChart.width(v).height(C).projection(d3.geo.mercator().rotate([-100.6331, -13.2]).translate([v / 2, C / 2]).center([1.5, -1.1]).scale(2.478*Math.min(v*1.872, C-69)+541+50)).transitionDuration(0);
            mapChart.render();
            d3.selectAll("#map-chart g path").on("mouseover", showMapDetail).on("mouseout", hideDetail);
        } else if (extenddiv == "zone-nation") {
            var n = document.getElementById("zone-nation").offsetWidth - svgPadding,
                o = document.getElementById("zone-nation").offsetHeight - svgPadding;
            nationChart.width(n).height(o).transitionDuration(0);
            nationChart.render();
            d3.selectAll("#nation-chart g rect").on("mouseover", showNationDetail).on("mouseout", hideDetail);
            d3.selectAll("#nation-chart g text").on("mouseover", showNationDetail).on("mouseout", hideDetail);
        } else if (extenddiv == "zone-sex") {
            var Nw = document.getElementById("zone-sex").offsetWidth - svgPadding,
                Nh = document.getElementById("zone-sex").offsetHeight - svgPadding;                  
            sexChart.width(Nw).height(Nh).cx(Nw/2+10).cy(Nh/2-10).radius(Math.min(Nw,Nh)*4/10).innerRadius(Math.min(Nw,Nh)*3/10).transitionDuration(0).legend(dc.legend().x((Nw/2)-Math.min(Nw,Nh)/7+10).y(Nh/2-Math.min(Nw,Nh)/9-10).itemHeight(10).gap(5)), 
            sexChart.render();
            d3.selectAll("#sex-chart g path").on("mouseover", showSexDetail).on("mouseout", hideDetail);
        } else {

        }

    }




    </script>
</body>

</html>
